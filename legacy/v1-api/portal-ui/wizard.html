<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locod.AI - Assistant de Création de Site</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        [x-cloak] { display: none !important; }
        .step-active { @apply bg-blue-600 text-white; }
        .step-completed { @apply bg-green-600 text-white; }
        .step-pending { @apply bg-gray-300 text-gray-700; }
        .wizard-step { transition: all 0.3s ease-in-out; }
        .fade-enter { opacity: 0; transform: translateX(20px); }
        .fade-enter-active { opacity: 1; transform: translateX(0); }
        .template-card { transition: all 0.2s ease-in-out; }
        .template-card:hover { transform: translateY(-2px); }
        .upload-area {
            border: 2px dashed #d1d5db;
            transition: all 0.2s ease-in-out;
        }
        .upload-area:hover { border-color: #3b82f6; background-color: #f8fafc; }
        .upload-area.dragover { border-color: #3b82f6; background-color: #eff6ff; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="enhancedWizardApp()" x-cloak class="min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex items-center">
                        <h1 class="text-xl font-bold text-gray-900">Assistant de Création de Site Locod.AI</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Language Selector -->
                        <select x-model="language" @change="updateLanguage()" 
                                class="text-sm border border-gray-300 rounded px-2 py-1">
                            <option value="fr">Français</option>
                            <option value="en">English</option>
                        </select>
                        <span class="text-sm text-gray-500">v1.1.1.9.2.4.2.5</span>
                        <button @click="showHelp = !showHelp" class="text-gray-400 hover:text-gray-600">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Help Modal -->
        <div x-show="showHelp" x-transition class="fixed inset-0 z-50 overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen px-4">
                <div class="fixed inset-0 bg-black opacity-50" @click="showHelp = false"></div>
                <div class="bg-white rounded-lg max-w-md mx-auto z-50 p-6">
                    <h2 class="text-lg font-bold mb-4" x-text="text.help.title"></h2>
                    <div class="space-y-2 text-sm text-gray-600">
                        <p x-text="text.help.navigation"></p>
                        <p x-text="text.help.autosave"></p>
                        <p x-text="text.help.optional"></p>
                        <p x-text="text.help.review"></p>
                    </div>
                    <button @click="showHelp = false" 
                            class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" 
                            x-text="text.common.close">
                    </button>
                </div>
            </div>
        </div>

        <!-- Template Preview Modal -->
        <div x-show="showTemplatePreview" x-transition class="fixed inset-0 z-50 overflow-y-auto">
            <div class="flex items-center justify-center min-h-screen px-4">
                <div class="fixed inset-0 bg-black opacity-50" @click="showTemplatePreview = null"></div>
                <div class="bg-white rounded-lg max-w-lg mx-auto z-50 p-6">
                    <template x-if="showTemplatePreview">
                        <div>
                            <h2 class="text-xl font-bold mb-4">Aperçu du Template</h2>
                            <div class="mb-6">
                                <!-- Template Preview Content -->
                                <div class="bg-gray-100 rounded-lg p-6 mb-4">
                                    <h3 class="text-lg font-semibold mb-2" x-text="showTemplatePreview.displayName || showTemplatePreview.name"></h3>
                                    <p class="text-gray-600 mb-4" x-text="showTemplatePreview.description"></p>
                                    
                                    <div class="space-y-3 text-sm">
                                        <div><strong>Version:</strong> <span x-text="showTemplatePreview.version || '1.0.0'"></span></div>
                                        <div><strong>Architecture:</strong> React moderne avec Tailwind CSS</div>
                                        <div><strong>Fonctionnalités disponibles:</strong></div>
                                        <ul class="list-disc list-inside ml-4 text-gray-600 space-y-1">
                                            <li><span class="text-green-600">✓</span> Architecture React moderne et performante</li>
                                            <li><span class="text-green-600">✓</span> Design responsive (mobile, tablet, desktop)</li>
                                            <li><span class="text-blue-600">✓</span> Workflows automatisés avec N8N</li>
                                            <li><span class="text-green-600">✓</span> Blog intégré avec gestion de contenu</li>
                                            <li><span class="text-orange-600">○</span> E-boutique (en développement)</li>
                                            <li><span class="text-green-600">✓</span> Formulaires de contact avancés</li>
                                            <li><span class="text-green-600">✓</span> Navigation adaptative</li>
                                            <li><span class="text-green-600">✓</span> Optimisé pour le SEO</li>
                                            <li><span class="text-green-600">✓</span> Système de thèmes personnalisables</li>
                                        </ul>
                                        
                                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                            <p class="text-blue-800 text-sm">
                                                <strong>Note:</strong> Les couleurs, contenus et logos seront personnalisés dans les prochaines étapes selon vos préférences.
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-between">
                                <button @click="showTemplatePreview = null" 
                                        class="px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors">
                                    Fermer
                                </button>
                                <button @click="selectTemplate(showTemplatePreview.name); showTemplatePreview = null" 
                                        class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition-colors">
                                    Utiliser ce template
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- Enhanced Progress Bar -->
        <div class="max-w-5xl mx-auto px-4 py-8">
            <!-- Step Counter -->
            <div class="text-center mb-6">
                <span class="text-lg font-semibold text-gray-700">Étape <span x-text="currentStep + 1"></span> sur 8</span>
            </div>
            
            <!-- Visual Progress Bar -->
            <div class="mb-8">
                <div class="w-full bg-gray-200 rounded-full h-2 mb-6">
                    <div class="bg-blue-600 h-2 rounded-full transition-all duration-500 ease-out" 
                         :style="`width: ${((currentStep + 1) / 8) * 100}%`"></div>
                </div>
                
                <!-- Step Circles -->
                <div class="flex justify-between items-center relative">
                    <template x-for="(step, index) in steps" :key="index">
                        <div class="flex flex-col items-center relative z-10">
                            <!-- Circle -->
                            <div :class="[
                                'w-12 h-12 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300 border-2',
                                index < currentStep ? 'bg-green-600 text-white border-green-600' : 
                                index === currentStep ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-400 border-gray-300'
                            ]">
                                <!-- Checkmark for completed steps -->
                                <svg x-show="index < currentStep" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                </svg>
                                <!-- Step number -->
                                <span x-show="index >= currentStep" x-text="index + 1"></span>
                            </div>
                            
                            <!-- Step Label -->
                            <div class="mt-3 text-center max-w-20">
                                <span :class="[
                                    'text-xs font-medium',
                                    index <= currentStep ? 'text-gray-900' : 'text-gray-500'
                                ]" x-text="step.title"></span>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Connector Line -->
                    <div class="absolute top-6 left-6 right-6 h-0.5 bg-gray-300 -z-0">
                        <div class="h-full bg-green-600 transition-all duration-500 ease-out" 
                             :style="`width: ${(currentStep / 7) * 100}%`"></div>
                    </div>
                </div>
            </div>

            <!-- Step Content Container -->
            <div class="bg-white rounded-lg shadow-sm min-h-96">
                
                <!-- Step 0: Welcome & Language -->
                <div x-show="currentStep === 0" x-transition class="wizard-step p-8">
                    <div class="text-center max-w-2xl mx-auto">
                        <h2 class="text-3xl font-bold text-gray-900 mb-4" x-text="text.welcome.title"></h2>
                        <p class="text-lg text-gray-600 mb-8" x-text="text.welcome.subtitle"></p>
                        
                        <!-- Site Language Selection -->
                        <div class="mb-8">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Langue de votre site web</label>
                            <select x-model="wizardData.siteLanguage" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="fr">Français</option>
                                <option value="en">English</option>
                                <option value="es">Español</option>
                                <option value="de">Deutsch</option>
                            </select>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="text-left bg-gray-50 p-6 rounded-lg mb-6">
                            <h3 class="font-semibold mb-2" x-text="text.welcome.terms.title"></h3>
                            <ul class="text-sm text-gray-600 space-y-1">
                                <li x-text="text.welcome.terms.item1"></li>
                                <li x-text="text.welcome.terms.item2"></li>
                                <li x-text="text.welcome.terms.item3"></li>
                            </ul>
                            <label class="flex items-center mt-4">
                                <input type="checkbox" x-model="wizardData.termsAccepted" class="mr-2">
                                <span class="text-sm" x-text="text.welcome.terms.accept"></span>
                            </label>
                        </div>

                        <button @click="nextStep()" 
                                :disabled="!wizardData.termsAccepted"
                                :class="[
                                    'px-8 py-3 rounded-lg font-medium transition-colors',
                                    wizardData.termsAccepted 
                                        ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                ]"
                                x-text="text.common.start">
                        </button>
                    </div>
                </div>

                <!-- Step 1: Template Selection -->
                <div x-show="currentStep === 1" x-transition class="wizard-step p-8">
                    <h2 class="text-2xl font-bold mb-6">Sélection de Modèle</h2>
                    <p class="text-gray-600 mb-8">Sélectionnez un modèle de base pour votre site</p>

                    <!-- Single Template Display -->
                    <div class="max-w-md mx-auto mb-8">
                        <template x-for="template in availableTemplates" :key="template.name">
                            <div :class="[
                                'template-card p-8 border-2 rounded-lg transition-all duration-300 cursor-pointer hover:shadow-lg',
                                wizardData.selectedTemplate === template.name 
                                    ? 'border-blue-600 bg-blue-50 ring-2 ring-blue-200' 
                                    : 'border-gray-200 hover:border-gray-300'
                            ]" @click="selectTemplate(template.name)">
                                <div class="text-center">
                                    <!-- Template Icon -->
                                    <div class="w-20 h-20 mx-auto mb-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"></path>
                                        </svg>
                                    </div>
                                    
                                    <!-- Template Info -->
                                    <h3 class="text-xl font-bold text-gray-900 mb-2" x-text="template.displayName || template.name"></h3>
                                    <p class="text-gray-600 mb-4" x-text="template.description"></p>
                                    
                                    <!-- Selected Badge -->
                                    <div x-show="wizardData.selectedTemplate === template.name" class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 mb-4">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                        </svg>
                                        Sélectionné
                                    </div>
                                    
                                    <!-- Preview Button -->
                                    <button @click.stop="showTemplatePreview = {
                                        name: template.name,
                                        displayName: template.displayName || 'Template Basic',
                                        description: template.description,
                                        version: template.version || '1.0.0'
                                    }" 
                                            class="bg-white text-blue-600 border border-blue-600 px-4 py-2 rounded hover:bg-blue-50 transition-colors">
                                        Aperçu
                                    </button>
                                </div>
                            </div>
                        </template>
                        
                        <!-- No Templates Fallback -->
                        <div x-show="availableTemplates.length === 0" class="text-center py-12">
                            <div class="w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-lg flex items-center justify-center">
                                <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                            </div>
                            <p class="text-gray-500">Aucun modèle disponible</p>
                        </div>
                    </div>

                    <!-- Template Architecture Info -->
                    <div x-show="wizardData.selectedTemplate && wizardData.selectedTemplate !== 'custom'" 
                         class="bg-gray-50 p-6 rounded-lg mb-6">
                        <h3 class="font-semibold mb-4">Architecture du Template</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-2">Technologies incluses</h4>
                                <div class="space-y-2 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                        <span>React 18 + Vite</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                        <span>Tailwind CSS</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                        <span>Responsive Design</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-700 mb-2">Fonctionnalités disponibles</h4>
                                <div class="space-y-2 text-sm text-gray-600">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                        <span>Workflows automatisés (N8N)</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                        <span>Blog intégré</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-orange-500 rounded-full mr-2"></div>
                                        <span>E-boutique (à venir)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                            <p class="text-blue-800 text-sm">
                                <strong>Note:</strong> Les couleurs, logos et contenus seront personnalisés dans les prochaines étapes.
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-between">
                        <button @click="prevStep()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50" x-text="text.common.previous"></button>
                        <button @click="nextStep()" 
                                :disabled="!wizardData.selectedTemplate"
                                :class="[
                                    'px-6 py-2 rounded-lg font-medium transition-colors',
                                    wizardData.selectedTemplate 
                                        ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                ]"
                                x-text="text.common.next">
                        </button>
                    </div>
                </div>

                <!-- Step 2: Business Information -->
                <div x-show="currentStep === 2" x-transition class="wizard-step p-8">
                    <h2 class="text-2xl font-bold mb-6">Informations sur votre Entreprise</h2>
                    <p class="text-gray-600 mb-8">Parlez-nous de votre entreprise pour personnaliser votre site</p>
                    
                    <div class="space-y-6">
                        <!-- Site Name -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Nom de votre site/entreprise *
                            </label>
                            <input type="text" 
                                   x-model="wizardData.siteName" 
                                   @input="validateSiteName()"
                                   class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   :class="errors.siteName ? 'border-red-500' : 'border-gray-300'"
                                   placeholder="Mon Entreprise"
                                   maxlength="50">
                            <div x-show="errors.siteName" class="text-red-500 text-sm mt-1" x-text="errors.siteName"></div>
                        </div>

                        <!-- Business Type (Free Input with Suggestions) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Type d'activité *
                            </label>
                            <div class="relative">
                                <input type="text" 
                                       x-model="wizardData.businessType" 
                                       @input="handleBusinessTypeInput($event)"
                                       @focus="showBusinessTypeSuggestions = true"
                                       class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       :class="errors.businessType ? 'border-red-500' : 'border-gray-300'"
                                       placeholder="Ex: Traduction, Éducation, Plomberie, Restaurant..."
                                       maxlength="50">
                                       
                                <!-- Suggestions Dropdown -->
                                <div x-show="showBusinessTypeSuggestions && filteredBusinessTypes.length > 0" 
                                     class="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto">
                                    <template x-for="suggestion in filteredBusinessTypes" :key="suggestion.key">
                                        <div @click="selectBusinessTypeSuggestion(suggestion.key, suggestion.name)" 
                                             class="px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0">
                                            <div class="font-medium text-gray-900" x-text="suggestion.name"></div>
                                            <div class="text-sm text-gray-600" x-text="suggestion.description"></div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            <div x-show="errors.businessType" class="text-red-500 text-sm mt-1" x-text="errors.businessType"></div>
                            <p class="text-sm text-gray-500 mt-1">Tapez librement ou choisissez une suggestion</p>
                        </div>

                        <!-- Business Description -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Description de votre entreprise
                            </label>
                            <textarea x-model="wizardData.businessDescription" 
                                      rows="4"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Décrivez votre entreprise et vos services en quelques mots"
                                      maxlength="200"></textarea>
                            <div class="text-sm text-gray-400 mt-1" x-text="(wizardData.businessDescription || '').length + '/200 caractères'"></div>
                        </div>

                        <!-- Terminology -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Terme pour désigner vos prestations *
                            </label>
                            <input type="text" 
                                   x-model="wizardData.terminology" 
                                   @input="wizardData.terminology = wizardData.terminology || 'services'"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   :placeholder="'Ex: ' + (wizardData.terminology || 'services')"
                                   maxlength="30">
                            <p class="text-sm text-gray-500 mt-1">
                                Ce terme sera utilisé dans la navigation et les titres (ex: "Services", "Interventions", "Cours", "Spécialités")
                            </p>
                        </div>

                        <!-- Domain -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Nom de domaine souhaité
                            </label>
                            <input type="text" 
                                   x-model="wizardData.domain" 
                                   @input="validateDomain()"
                                   class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   :class="errors.domain ? 'border-red-500' : 'border-gray-300'"
                                   placeholder="mon-entreprise.com">
                            <div x-show="errors.domain" class="text-red-500 text-sm mt-1" x-text="errors.domain"></div>
                            <p class="text-sm text-gray-500 mt-1">Optionnel - Format: domain.com (sans http://)</p>
                        </div>

                        <!-- Slogan -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Slogan/Phrase d'accroche
                            </label>
                            <textarea x-model="wizardData.slogan" rows="2" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                      placeholder="Phrase accrocheuse pour votre site"
                                      maxlength="100"></textarea>
                            <div class="text-sm text-gray-400 mt-1" x-text="(wizardData.slogan || '').length + '/100 caractères'"></div>
                        </div>

                        <!-- Generated Site ID Preview -->
                        <div x-show="wizardData.siteName" class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-700 mb-2">Aperçu de l'identifiant du site</h3>
                            <p class="text-sm text-gray-600 mb-2">Identifiant généré automatiquement :</p>
                            <code class="bg-white px-2 py-1 rounded text-blue-600 text-sm" x-text="generateSiteId(wizardData.siteName)"></code>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button @click="prevStep()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            Précédent
                        </button>
                        <button @click="nextStep()" 
                                :disabled="!canProceedFromStep2()"
                                :class="[
                                    'px-6 py-2 rounded-lg font-medium transition-colors',
                                    canProceedFromStep2() 
                                        ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                ]">
                            Suivant
                        </button>
                    </div>
                </div>

                <!-- Step 3: Content & Activities -->
                <div x-show="currentStep === 3" x-transition class="wizard-step p-8" x-data="{ activeContentTab: 'principal' }">
                    <h2 class="text-2xl font-bold mb-6">Contenu de votre site</h2>
                    <p class="text-gray-600 mb-4">Générez et éditez tout le contenu textuel de votre site</p>

                    <!-- AI Generation Button (always visible) -->
                    <div class="flex justify-between items-center mb-6">
                        <!-- Content Tabs Navigation -->
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-4 md:space-x-8 overflow-x-auto">
                                <button @click="activeContentTab = 'principal'" 
                                        :class="activeContentTab === 'principal' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    🎯 Principal
                                </button>
                                <button @click="activeContentTab = 'services'" 
                                        :class="activeContentTab === 'services' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    <span x-text="'📋 ' + (wizardData.terminology || 'Services')"></span>
                                </button>
                                <button @click="activeContentTab = 'about'" 
                                        :class="activeContentTab === 'about' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    📖 À Propos
                                </button>
                                <button @click="activeContentTab = 'testimonials'" 
                                        :class="activeContentTab === 'testimonials' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    💬 Témoignages
                                </button>
                                <button @click="activeContentTab = 'faq'" 
                                        :class="activeContentTab === 'faq' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    ❓ FAQ
                                </button>
                                <button @click="activeContentTab = 'contact'" 
                                        :class="activeContentTab === 'contact' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    📞 Contact
                                </button>
                                <button @click="activeContentTab = 'blog'" 
                                        :class="activeContentTab === 'blog' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                        class="py-2 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                                    📝 Blog
                                </button>
                            </nav>
                        </div>
                        
                        <button @click="generateCompleteContent()" 
                                :disabled="aiRequest.status === 'processing'"
                                class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-purple-600 to-purple-700 text-white font-medium rounded-lg shadow-lg hover:from-purple-700 hover:to-purple-800 transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" x-show="aiRequest.status !== 'processing'">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                            </svg>
                            <svg class="animate-spin w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" x-show="aiRequest.status === 'processing'">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            <span x-show="aiRequest.status !== 'processing'">Générer par IA</span>
                            <span x-show="aiRequest.status === 'processing'">Génération...</span>
                        </button>
                    </div>

                    <!-- AI Request Status (shows in all tabs) -->
                    <div x-show="aiRequest.id" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="flex items-center space-x-3">
                            <div x-show="aiRequest.status === 'processing'" class="flex-shrink-0">
                                <svg class="animate-spin h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24">
                                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"></circle>
                                    <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" class="opacity-75"></path>
                                </svg>
                            </div>
                            <div x-show="aiRequest.status === 'completed'" class="flex-shrink-0">
                                <svg class="h-5 w-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div x-show="aiRequest.status === 'pending' || aiRequest.status === 'assigned' || aiRequest.status === 'processing'">
                                    <p class="text-sm font-medium">
                                        <span x-show="aiRequest.status === 'pending'">⏳ En attente d'un expert...</span>
                                        <span x-show="aiRequest.status === 'assigned'">👨‍💼 Expert assigné...</span>
                                        <span x-show="aiRequest.status === 'processing'">🧠 Génération IA en cours...</span>
                                    </p>
                                    <p class="text-xs text-gray-600 mt-1">
                                        ⏱️ Temps: <span x-text="aiRequest.elapsedTime"></span>
                                    </p>
                                </div>
                                <div x-show="aiRequest.status === 'completed'" class="text-green-800">
                                    <p class="text-sm font-medium">✅ Contenu généré avec succès!</p>
                                    <p class="text-xs mt-1">📝 Vérifiez et éditez le contenu dans chaque tab.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6">
                        <!-- Tab: Principal (Hero Content) -->
                        <div x-show="activeContentTab === 'principal'" class="space-y-4">
                            <h3 class="text-lg font-semibold mb-4">🎯 Contenu Principal de la Page d'Accueil</h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Titre Principal *</label>
                                <input type="text" x-model="wizardData.hero.title" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="Ex: Solutions de traduction professionnelle">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sous-titre</label>
                                <input type="text" x-model="wizardData.hero.subtitle" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="Ex: Votre partenaire pour une communication internationale">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea x-model="wizardData.hero.description" rows="4" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="Ex: Nous offrons des services de traduction de haute qualité..."></textarea>
                            </div>
                        </div>

                        <!-- Tab: Services/Activities -->
                        <div x-show="activeContentTab === 'services'" class="space-y-4">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold" x-text="'📋 Vos ' + (wizardData.terminology || 'Services')"></h3>
                                <button @click="addService()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 text-sm">
                                    + Ajouter
                                </button>
                            </div>
                            <template x-for="(service, index) in wizardData.services" :key="service.id || index">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="flex items-start space-x-4">
                                        <div class="flex-1 space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                                <input type="text" x-model="service.name" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="Ex: Traduction technique">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                                <textarea x-model="service.description" rows="2"
                                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                          placeholder="Ex: Traduction de documents techniques..."></textarea>
                                            </div>
                                        </div>
                                        <button @click="removeService(index)" x-show="wizardData.services.length > 1"
                                                class="text-red-600 hover:text-red-800 mt-6">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <!-- Tab: About -->
                        <div x-show="activeContentTab === 'about'" class="space-y-4">
                            <h3 class="text-lg font-semibold mb-4">📖 À Propos de votre Entreprise</h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Titre de la Section</label>
                                <input type="text" x-model="wizardData.about.title" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       :placeholder="'À propos de ' + wizardData.siteName">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description de l'Entreprise</label>
                                <textarea x-model="wizardData.about.description" rows="4" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="Décrivez votre entreprise, son histoire, sa mission..."></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Valeurs de l'Entreprise (optionnel)</label>
                                <div class="space-y-2">
                                    <template x-for="(value, index) in (wizardData.about.values || [])" :key="index">
                                        <div class="flex space-x-2">
                                            <input type="text" x-model="value.title" placeholder="Valeur" 
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <input type="text" x-model="value.description" placeholder="Description" 
                                                   class="flex-2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Tab: Testimonials -->
                        <div x-show="activeContentTab === 'testimonials'" class="space-y-4">
                            <h3 class="text-lg font-semibold mb-4">💬 Témoignages Clients</h3>
                            <template x-for="(testimonial, index) in (wizardData.testimonials || [])" :key="index">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Témoignage</label>
                                            <textarea x-model="testimonial.text" rows="3"
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Le témoignage du client..."></textarea>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                                <input type="text" x-model="testimonial.name" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="Jean Dupont">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Poste/Entreprise</label>
                                                <input type="text" x-model="testimonial.position" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="PDG, Entreprise XYZ">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!wizardData.testimonials || wizardData.testimonials.length === 0" class="text-gray-500 text-center py-8">
                                Aucun témoignage. Cliquez sur "Générer par IA" pour créer des témoignages.
                            </div>
                        </div>

                        <!-- Tab: FAQ -->
                        <div x-show="activeContentTab === 'faq'" class="space-y-4">
                            <h3 class="text-lg font-semibold mb-4">❓ Questions Fréquentes</h3>
                            <template x-for="(item, index) in (wizardData.faq || [])" :key="index">
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Question</label>
                                            <input type="text" x-model="item.question" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="Question fréquente...">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Réponse</label>
                                            <textarea x-model="item.answer" rows="2"
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Réponse détaillée..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!wizardData.faq || wizardData.faq.length === 0" class="text-gray-500 text-center py-8">
                                Aucune FAQ. Cliquez sur "Générer par IA" pour créer des questions/réponses.
                            </div>
                        </div>

                        <!-- Tab: Contact -->
                        <div x-show="activeContentTab === 'contact'" class="space-y-4">
                            <h3 class="text-lg font-semibold mb-4">📞 Informations de Contact</h3>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                <input type="email" x-model="wizardData.contact.email" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="contact@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Téléphone</label>
                                <input type="tel" x-model="wizardData.contact.phone" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                       placeholder="+33 1 23 45 67 89">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                                <textarea x-model="wizardData.contact.address" rows="2"
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                          placeholder="123 Rue Example, 75001 Paris"></textarea>
                            </div>
                        </div>

                        <!-- Tab: Blog -->
                        <div x-show="activeContentTab === 'blog'" class="space-y-4">
                            <div class="flex justify-between items-center mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold">📝 Articles de Blog</h3>
                                    <p class="text-sm text-gray-600 mt-1">Générez des articles de blog pour améliorer votre référencement et engager vos visiteurs.</p>
                                </div>
                                <button @click="addBlogArticle()" class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 text-sm">
                                    ➕ Ajouter un article
                                </button>
                            </div>
                            <template x-for="(article, index) in (wizardData.blog?.articles || [])" :key="index">
                                <div class="border border-gray-200 rounded-lg p-4 relative">
                                    <button @click="removeBlogArticle(index)" 
                                            x-show="wizardData.blog?.articles?.length > 1"
                                            class="absolute top-2 right-2 text-red-600 hover:text-red-800">
                                        ❌
                                    </button>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Titre de l'article <span class="text-gray-500">#<span x-text="index + 1"></span></span></label>
                                            <input type="text" x-model="article.title" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="Ex: Les avantages de la traduction professionnelle">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Résumé</label>
                                            <textarea x-model="article.excerpt" rows="2"
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Bref résumé de l'article..."></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Contenu</label>
                                            <textarea x-model="article.content" rows="6"
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Contenu complet de l'article..."></textarea>
                                        </div>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Catégorie</label>
                                                <input type="text" x-model="article.category" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="Ex: Conseils">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Tags (séparés par des virgules)</label>
                                                <input type="text" 
                                                       :value="Array.isArray(article.tags) ? article.tags.join(', ') : article.tags"
                                                       @input="article.tags = $event.target.value.split(',').map(t => t.trim()).filter(t => t)"
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="Ex: traduction, business, international">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </template>
                            <div x-show="!wizardData.blog?.articles || wizardData.blog.articles.length === 0" class="text-gray-500 text-center py-8">
                                Aucun article. Cliquez sur "Générer par IA" pour créer des articles de blog.
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="flex justify-between mt-8">
                        <button @click="prevStep()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Précédent</button>
                        <button @click="nextStep()" 
                                :disabled="!wizardData.contact.email || wizardData.services.some(a => !a.name)"
                                :class="[
                                    'px-6 py-2 rounded-lg font-medium transition-colors',
                                    wizardData.contact.email && !wizardData.services.some(a => !a.name)
                                        ? 'bg-blue-600 text-white hover:bg-blue-700' 
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                ]">
                            Suivant
                        </button>
                    </div>
                </div>

                <!-- Step 4: Images & Assets SIMPLIFIE -->
                <div x-show="currentStep === 4" x-transition class="wizard-step p-8">
                    <h2 class="text-2xl font-bold mb-6">Images et Visuels</h2>
                    <p class="text-gray-600 mb-8">Choisissez comment créer les images de votre site</p>

                    <!-- Résumé des images nécessaires -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <h3 class="font-semibold text-blue-900 mb-2">Images nécessaires pour votre site :</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm text-blue-800">
                            <div>• Logo navigation (clair)</div>
                            <div>• Logo footer (sombre)</div>
                            <div>• Image bannière hero</div>
                            <div>• Favicons (clair & sombre)</div>
                            <div>• <span x-text="wizardData.services?.length || 0"></span> images pour vos <span x-text="wizardData.terminology || 'services'"></span></div>
                            <div x-show="wizardData.blog?.articles?.length > 0">• <span x-text="wizardData.blog?.articles?.length || 0"></span> images d'articles</div>
                        </div>
                    </div>

                    <!-- Choix simplifié -->
                    <div class="space-y-4">
                        <!-- Option 1: Upload manuel -->
                        <div class="border-2 rounded-lg p-6 cursor-pointer transition-all"
                             :class="wizardData.imageApproach === 'manual' ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:border-gray-300'"
                             @click="selectImageApproach('manual')">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <input type="radio" :checked="wizardData.imageApproach === 'manual'" class="mt-1">
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-lg mb-1">J'ai déjà mes images</h4>
                                    <p class="text-gray-600 text-sm">Uploadez vos propres logos et images maintenant</p>
                                    <div class="mt-2 text-green-600 font-medium text-sm">✓ Immédiat et gratuit</div>
                                </div>
                            </div>
                            
                            <!-- Upload interface si sélectionné -->
                            <div x-show="wizardData.imageApproach === 'manual'" x-transition class="mt-6 border-t pt-6">
                                <!-- Image bannière - Featured prominently -->
                                <div class="mb-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <label class="block text-sm font-medium mb-2 text-blue-900">🏠 Image Bannière (Hero)</label>
                                    <p class="text-xs text-blue-700 mb-3">Grande image d'accueil en arrière-plan de votre page principale</p>
                                    <div class="flex justify-center">
                                        <div @drop="handleFileDrop($event, 'hero')" 
                                             @dragover.prevent 
                                             class="border-2 border-dashed border-blue-300 rounded-lg p-4 text-center hover:border-blue-400 cursor-pointer h-32 w-48 flex items-center justify-center bg-white"
                                             @click="$refs.manualHeroInput.click()">
                                            <template x-if="!wizardData.images.hero">
                                                <div class="text-blue-400">
                                                    <svg class="w-8 h-8 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                    </svg>
                                                    <p class="text-xs">Bannière hero</p>
                                                </div>
                                            </template>
                                            <template x-if="wizardData.images.hero">
                                                <div>
                                                    <img :src="wizardData.images.hero" class="max-h-20 mx-auto">
                                                    <p class="text-xs text-green-600 mt-1">✓ Uploadé</p>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 text-center mt-2">Recommandé: 1920x1080px</p>
                                    <input type="file" x-ref="manualHeroInput" @change="handleFileUpload($event, 'hero')" accept="image/*" class="hidden">
                                </div>

                                <!-- Logos - Grouped together -->
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h4 class="text-sm font-medium mb-3 text-green-900">🏢 Logos du Site</h4>
                                    <div class="grid grid-cols-2 gap-4">
                                        <!-- Logo principal -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Logo Navigation</label>
                                            <div @drop="handleFileDrop($event, 'logo')" 
                                                 @dragover.prevent 
                                                 class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 cursor-pointer h-24 flex items-center justify-center"
                                                 @click="$refs.manualLogoInput.click()">
                                                <template x-if="!wizardData.images.logo">
                                                    <div class="text-gray-400">
                                                        <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                        </svg>
                                                        <p class="text-xs">Menu principal</p>
                                                    </div>
                                                </template>
                                                <template x-if="wizardData.images.logo">
                                                    <div>
                                                        <img :src="wizardData.images.logo" class="max-h-16 mx-auto">
                                                        <p class="text-xs text-green-600 mt-1">✓ Uploadé</p>
                                                    </div>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="manualLogoInput" @change="handleFileUpload($event, 'logo')" accept="image/*" class="hidden">
                                        </div>
                                        
                                        <!-- Logo footer -->
                                        <div>
                                            <label class="block text-sm font-medium mb-2">Logo Footer</label>
                                            <div @drop="handleFileDrop($event, 'logoFooter')" 
                                                 @dragover.prevent 
                                                 class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center hover:border-gray-400 cursor-pointer h-24 flex items-center justify-center"
                                                 @click="$refs.manualLogoFooterInput.click()">
                                                <template x-if="!wizardData.images.logoFooter">
                                                    <div class="text-gray-400">
                                                        <svg class="w-6 h-6 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                        </svg>
                                                        <p class="text-xs">Pied de page</p>
                                                    </div>
                                                </template>
                                                <template x-if="wizardData.images.logoFooter">
                                                    <div>
                                                        <img :src="wizardData.images.logoFooter" class="max-h-16 mx-auto">
                                                        <p class="text-xs text-green-600 mt-1">✓ Uploadé</p>
                                                    </div>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="manualLogoFooterInput" @change="handleFileUpload($event, 'logoFooter')" accept="image/*" class="hidden">
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-600 text-center mt-3">💡 Souvent identiques - vous pouvez utiliser la même image pour les deux</p>
                                </div>
                                
                                <!-- Favicons -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium mb-2">Favicons (optionnels)</label>
                                    <div class="grid grid-cols-2 gap-4">
                                        <!-- Favicon clair -->
                                        <div>
                                            <div @drop="handleFileDrop($event, 'faviconLight')" 
                                                 @dragover.prevent 
                                                 class="border-2 border-dashed border-gray-300 rounded-lg p-3 text-center hover:border-gray-400 cursor-pointer h-16 flex items-center justify-center"
                                                 @click="$refs.manualFaviconLightInput.click()">
                                                <template x-if="!wizardData.images.faviconLight">
                                                    <div class="text-gray-400">
                                                        <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                        </svg>
                                                        <p class="text-xs">Clair 32px</p>
                                                    </div>
                                                </template>
                                                <template x-if="wizardData.images.faviconLight">
                                                    <div>
                                                        <img :src="wizardData.images.faviconLight" class="max-h-8 mx-auto">
                                                        <p class="text-xs text-green-600 mt-1">✓</p>
                                                    </div>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="manualFaviconLightInput" @change="handleFileUpload($event, 'faviconLight')" accept="image/*" class="hidden">
                                        </div>
                                        
                                        <!-- Favicon sombre -->
                                        <div>
                                            <div @drop="handleFileDrop($event, 'faviconDark')" 
                                                 @dragover.prevent 
                                                 class="border-2 border-dashed border-gray-300 rounded-lg p-3 text-center hover:border-gray-400 cursor-pointer h-16 flex items-center justify-center"
                                                 @click="$refs.manualFaviconDarkInput.click()">
                                                <template x-if="!wizardData.images.faviconDark">
                                                    <div class="text-gray-400">
                                                        <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                                        </svg>
                                                        <p class="text-xs">Sombre 32px</p>
                                                    </div>
                                                </template>
                                                <template x-if="wizardData.images.faviconDark">
                                                    <div>
                                                        <img :src="wizardData.images.faviconDark" class="max-h-8 mx-auto">
                                                        <p class="text-xs text-green-600 mt-1">✓</p>
                                                    </div>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="manualFaviconDarkInput" @change="handleFileUpload($event, 'faviconDark')" accept="image/*" class="hidden">
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Images services -->
                                <div class="mt-4" x-show="wizardData.services && wizardData.services.length > 0">
                                    <label class="block text-sm font-medium mb-2">Images pour vos <span x-text="wizardData.terminology || 'services'"></span> (optionnelles)</label>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        <template x-for="(service, index) in wizardData.services" :key="service.id || index">
                                            <div>
                                                <div @drop="handleFileDrop($event, 'service_' + index)" 
                                                     @dragover.prevent 
                                                     class="border-2 border-dashed border-gray-300 rounded-lg p-2 text-center hover:border-gray-400 cursor-pointer h-16 flex items-center justify-center"
                                                     @click="triggerServiceUpload(index)">
                                                    <template x-if="!wizardData.images.services || !wizardData.images.services[index]">
                                                        <div class="text-gray-400">
                                                            <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 002 2z"></path>
                                                            </svg>
                                                            <p class="text-xs" x-text="(service.name || 'Service').substring(0,10)"></p>
                                                        </div>
                                                    </template>
                                                    <template x-if="wizardData.images.services && wizardData.images.services[index]">
                                                        <div>
                                                            <img :src="wizardData.images.services[index]" class="max-h-10 mx-auto">
                                                            <p class="text-xs text-green-600">✓</p>
                                                        </div>
                                                    </template>
                                                </div>
                                                <input type="file" :id="'serviceInput-' + index" @change="handleFileUpload($event, 'service_' + index)" accept="image/*" class="hidden">
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                
                                <!-- Images blog -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium mb-2">Images blog (optionnelles)</label>
                                    <p class="text-xs text-gray-500 mb-2">Images pour illustrer vos articles de blog</p>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        <template x-for="(article, index) in wizardData.blog?.articles || []" :key="'step4-blog-' + index">
                                            <div>
                                                <div @drop="handleFileDrop($event, 'blog_' + index)" 
                                                     @dragover.prevent 
                                                     class="border-2 border-dashed border-gray-300 rounded-lg p-2 text-center hover:border-gray-400 cursor-pointer h-16 flex items-center justify-center"
                                                     @click="triggerBlogUpload(index)">
                                                    <template x-if="!wizardData.images.blog || !wizardData.images.blog[index]">
                                                        <div class="text-gray-400">
                                                            <svg class="w-4 h-4 mx-auto mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 002 2z"></path>
                                                            </svg>
                                                            <p class="text-xs" x-text="article.title || `Blog #${index + 1}`"></p>
                                                        </div>
                                                    </template>
                                                    <template x-if="wizardData.images.blog && wizardData.images.blog[index]">
                                                        <div>
                                                            <img :src="wizardData.images.blog[index]" class="max-h-10 mx-auto">
                                                            <p class="text-xs text-green-600">✓</p>
                                                        </div>
                                                    </template>
                                                </div>
                                                <input type="file" :id="'blogInput-' + index" @change="handleFileUpload($event, 'blog_' + index)" accept="image/*" class="hidden">
                                            </div>
                                        </template>
                                    </div>
                                </div>

                                
                                <div class="text-sm text-gray-600 bg-blue-50 rounded-lg p-3 mt-4">
                                    <div class="space-y-1">
                                        <div><strong>Images requises:</strong></div>
                                        <div>• <strong>Logo principal:</strong> Logo affiché dans la navigation</div>
                                        <div>• <strong>Image bannière:</strong> Grande image d'accueil (hero)</div>
                                        <div class="mt-2"><strong>Images optionnelles:</strong></div>
                                        <div>• <strong>Logo footer:</strong> Version alternative pour le pied de page</div>
                                        <div>• <strong>Favicons:</strong> Icônes du site (32x32px)</div>
                                        <div>• <strong>Images services:</strong> Illustrations pour vos services</div>
                                        <div>• <strong>Images blog:</strong> Visuels pour vos articles</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Option 2: Génération IA -->
                        <div class="border-2 rounded-lg p-6 cursor-pointer transition-all"
                             :class="wizardData.imageApproach === 'ai' ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'"
                             @click="selectImageApproach('ai')">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <input type="radio" :checked="wizardData.imageApproach === 'ai'" class="mt-1">
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-lg mb-1">Générer mes images par IA</h4>
                                    <p class="text-gray-600 text-sm">Un expert créera toutes vos images selon votre activité</p>
                                    <div class="mt-2 text-purple-600 font-medium text-sm">🎨 Création professionnelle</div>
                                </div>
                            </div>
                            
                            <!-- Options IA si sélectionné -->
                            <div x-show="wizardData.imageApproach === 'ai'" x-transition class="mt-6 border-t pt-6">
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium mb-2">Style visuel souhaité</label>
                                        <select x-model="wizardData.aiStyle" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                            <option value="modern">Moderne et épuré</option>
                                            <option value="professional">Professionnel corporate</option>
                                            <option value="creative">Créatif et artistique</option>
                                            <option value="warm">Chaleureux et accessible</option>
                                        </select>
                                    </div>
                                    
                                    <button @click="requestImageGeneration()" 
                                            :disabled="imageAiRequest.status === 'processing'"
                                            class="w-full bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 disabled:opacity-50">
                                        <span x-show="!imageAiRequest.id">🎨 Demander la génération de toutes les images</span>
                                        <span x-show="imageAiRequest.status === 'pending'">⏳ En attente de traitement...</span>
                                        <span x-show="imageAiRequest.status === 'processing'">🎨 Génération en cours...</span>
                                        <span x-show="imageAiRequest.status === 'completed'">✅ Images prêtes !</span>
                                    </button>
                                    
                                    <div x-show="imageAiRequest.id" class="bg-purple-100 rounded-lg p-3 text-sm">
                                        <p class="text-purple-800">
                                            Demande #<span x-text="imageAiRequest.id"></span> créée.
                                            Un expert va générer vos images et les intégrer directement à votre site.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Option 3: Approche mixte -->
                        <div class="border-2 rounded-lg p-6 cursor-pointer transition-all"
                             :class="wizardData.imageApproach === 'mixed' ? 'border-orange-500 bg-orange-50' : 'border-gray-200 hover:border-gray-300'"
                             @click="selectImageApproach('mixed')">
                            <div class="flex items-start space-x-4">
                                <div class="flex-shrink-0">
                                    <input type="radio" :checked="wizardData.imageApproach === 'mixed'" class="mt-1">
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-lg mb-1">Approche mixte</h4>
                                    <p class="text-gray-600 text-sm">Uploadez certaines images et générez les autres par IA</p>
                                    <div class="mt-2 text-orange-600 font-medium text-sm">🔄 Flexible</div>
                                </div>
                            </div>
                            
                            <!-- Interface mixte si sélectionné -->
                            <div x-show="wizardData.imageApproach === 'mixed'" x-transition class="mt-6 border-t pt-6">
                                <p class="text-sm text-gray-600 mb-4">Pour chaque image, choisissez Upload ou IA :</p>
                                
                                <div class="space-y-4">
                                    <!-- Main Images Section -->
                                    <div>
                                        <h4 class="text-sm font-semibold text-gray-700 mb-2">🖼️ Images Principales</h4>
                                        <div class="space-y-2">
                                            <!-- Logo Navigation -->
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-sm">Logo navigation</span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('logo', 'upload'); $refs.mixedLogoInput.click()" 
                                                            :class="wizardData.imageChoices?.logo === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.logo">Upload</span>
                                                        <span x-show="wizardData.images?.logo">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('logo', 'ai')"
                                                            :class="wizardData.imageChoices?.logo === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                                <input type="file" x-ref="mixedLogoInput" @change="handleFileUpload($event, 'logo')" accept="image/*" class="hidden">
                                            </div>
                                            
                                            <!-- Logo Footer -->
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-sm">Logo footer</span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('logoFooter', 'upload'); $refs.mixedLogoFooterInput.click()" 
                                                            :class="wizardData.imageChoices?.logoFooter === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.logoFooter">Upload</span>
                                                        <span x-show="wizardData.images?.logoFooter">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('logoFooter', 'ai')"
                                                            :class="wizardData.imageChoices?.logoFooter === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                                <input type="file" x-ref="mixedLogoFooterInput" @change="handleFileUpload($event, 'logoFooter')" accept="image/*" class="hidden">
                                            </div>
                                            
                                            <!-- Hero Image -->
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-sm">Image bannière hero</span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('hero', 'upload'); $refs.mixedHeroInput.click()" 
                                                            :class="wizardData.imageChoices?.hero === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.hero">Upload</span>
                                                        <span x-show="wizardData.images?.hero">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('hero', 'ai')"
                                                            :class="wizardData.imageChoices?.hero === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                                <input type="file" x-ref="mixedHeroInput" @change="handleFileUpload($event, 'hero')" accept="image/*" class="hidden">
                                            </div>
                                            
                                            <!-- Favicon Light -->
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-sm">Favicon clair</span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('faviconLight', 'upload'); $refs.mixedFaviconLightInput.click()" 
                                                            :class="wizardData.imageChoices?.faviconLight === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.faviconLight">Upload</span>
                                                        <span x-show="wizardData.images?.faviconLight">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('faviconLight', 'ai')"
                                                            :class="wizardData.imageChoices?.faviconLight === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                                <input type="file" x-ref="mixedFaviconLightInput" @change="handleFileUpload($event, 'faviconLight')" accept="image/*" class="hidden">
                                            </div>
                                            
                                            <!-- Favicon Dark -->
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-sm">Favicon sombre</span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('faviconDark', 'upload'); $refs.mixedFaviconDarkInput.click()" 
                                                            :class="wizardData.imageChoices?.faviconDark === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.faviconDark">Upload</span>
                                                        <span x-show="wizardData.images?.faviconDark">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('faviconDark', 'ai')"
                                                            :class="wizardData.imageChoices?.faviconDark === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                                <input type="file" x-ref="mixedFaviconDarkInput" @change="handleFileUpload($event, 'faviconDark')" accept="image/*" class="hidden">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Services images -->
                                    <div x-show="wizardData.services && wizardData.services.length > 0" class="space-y-2">
                                        <p class="text-sm font-medium mt-2">Images pour vos <span x-text="wizardData.terminology || 'services'"></span>:</p>
                                        <template x-for="(service, index) in wizardData.services" :key="'mixed-service-' + index">
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-xs" x-text="service.name || 'Service ' + (index + 1)"></span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('service_' + index, 'upload'); triggerServiceUpload(index)" 
                                                            :class="wizardData.imageChoices?.services && wizardData.imageChoices.services[index] === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.services || !wizardData.images.services[index]">Upload</span>
                                                        <span x-show="wizardData.images?.services && wizardData.images.services[index]">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('service_' + index, 'ai')"
                                                            :class="wizardData.imageChoices?.services && wizardData.imageChoices.services[index] === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                    <!-- Blog images -->
                                    <div x-show="wizardData.blog?.articles && wizardData.blog.articles.length > 0" class="space-y-2">
                                        <p class="text-sm font-medium mt-2">Images pour vos articles de blog:</p>
                                        <template x-for="(article, index) in wizardData.blog.articles" :key="'mixed-blog-' + index">
                                            <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                                                <span class="text-xs" x-text="(article.title || 'Article ' + (index + 1)).substring(0, 30)"></span>
                                                <div class="flex space-x-1">
                                                    <button @click="setImageChoice('blog_' + index, 'upload'); triggerBlogUpload(index)" 
                                                            :class="wizardData.imageChoices?.blog && wizardData.imageChoices.blog[index] === 'upload' ? 'bg-blue-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        <span x-show="!wizardData.images?.blog || !wizardData.images.blog[index]">Upload</span>
                                                        <span x-show="wizardData.images?.blog && wizardData.images.blog[index]">✓</span>
                                                    </button>
                                                    <button @click="setImageChoice('blog_' + index, 'ai')"
                                                            :class="wizardData.imageChoices?.blog && wizardData.imageChoices.blog[index] === 'ai' ? 'bg-purple-600 text-white' : 'bg-gray-200'"
                                                            class="px-2 py-1 rounded text-xs">
                                                        IA
                                                    </button>
                                                </div>
                                            </div>
                                        </template>
                                    </div>

                                </div>
                                
                                <!-- Bouton pour générer les images IA manquantes -->
                                <button x-show="hasAIChoices()" 
                                        @click="requestImageGeneration()" 
                                        class="mt-4 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                    🎨 Générer les images marquées "IA"
                                </button>
                            </div>
                        </div>

                    <!-- Message d'information -->
                    <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                        <p class="text-sm text-gray-600">
                            <strong>Note :</strong> Les images générées par IA seront automatiquement renommées et optimisées pour votre site.
                            Vous pourrez les modifier ultérieurement dans votre espace d'administration.
                        </p>
                    </div>

                    <!-- Navigation buttons -->
                    <div class="flex justify-between mt-8">
                        <button @click="currentStep--" 
                                class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400" 
                                x-text="text.common.previous"></button>
                        <button @click="currentStep++" 
                                :disabled="!canProceedFromCurrentStep()"
                                :class="canProceedFromCurrentStep() ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-400 cursor-not-allowed'"
                                class="text-white px-6 py-2 rounded-lg" 
                                x-text="text.common.next"></button>
                    </div>
                </div>
                </div> <!-- Close Step 5 (Images) properly -->

                <!-- Step 7: Final Review & Creation (moved from Step 6) -->
                <div x-show="currentStep === 6" x-transition class="wizard-step p-8" x-data="{ activeTab: 'config', activeContentTab: 'hero' }">
                    <h2 class="text-2xl font-bold mb-6">📋 Révision Finale & Création</h2>
                    <p class="text-gray-600 mb-6">Vérifiez et modifiez tous vos paramètres avant de créer votre site</p>

                    <!-- Tab Navigation -->
                    <div class="border-b border-gray-200 mb-8">
                        <nav class="-mb-px flex space-x-8">
                            <button @click="activeTab = 'config'" 
                                    :class="activeTab === 'config' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                🏢 Configuration
                            </button>
                            <button @click="activeTab = 'content'" 
                                    :class="activeTab === 'content' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                📝 Contenu & Services
                            </button>
                            <button @click="activeTab = 'blog'" 
                                    :class="activeTab === 'blog' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                📰 Blog & Articles
                            </button>
                            <button @click="activeTab = 'contact'" 
                                    :class="activeTab === 'contact' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                📞 Contact & Infos
                            </button>
                            <button @click="activeTab = 'summary'" 
                                    :class="activeTab === 'summary' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                ✅ Résumé & Création
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Contents -->
                    <div class="min-h-96" x-data="{ activeContentTab: 'hero' }">
                        
                        <!-- Tab 1: Configuration & Images -->
                        <div x-show="activeTab === 'config'" x-transition class="space-y-6">
                            <!-- Basic Info with Logo/Hero -->
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-blue-900 mb-4">🏢 Configuration & Images Principales</h3>
                                
                                <!-- Basic Info Section -->
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nom du site</label>
                                        <input type="text" x-model="wizardData.siteName" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Domaine</label>
                                        <input type="text" x-model="wizardData.domain" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Type d'activité</label>
                                        <input type="text" x-model="wizardData.businessType" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Terminologie</label>
                                        <input type="text" x-model="wizardData.terminology" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Slogan</label>
                                        <textarea x-model="wizardData.slogan" rows="2" 
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                    </div>
                                </div>

                                <!-- Images Section within same box -->
                                <div class="border-t pt-4">
                                    <h4 class="text-sm font-semibold text-gray-700 mb-3">Images Principales</h4>
                                    <div class="grid grid-cols-3 gap-4 mb-3">
                                        <!-- Logo Navbar -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Logo Navigation (Clair)</label>
                                            <div @click="$refs.revLogoInput.click()" class="h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-white cursor-pointer hover:border-blue-400">
                                                <template x-if="wizardData.images?.logo">
                                                    <img :src="wizardData.images.logo" class="max-h-16 object-contain">
                                                </template>
                                                <template x-if="!wizardData.images?.logo">
                                                    <span class="text-xs text-gray-400">+ Logo Nav</span>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="revLogoInput" @change="handleFileUpload($event, 'logo')" accept="image/*" class="hidden">
                                        </div>
                                        <!-- Logo Footer -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Logo Footer (Sombre)</label>
                                            <div @click="$refs.revLogoFooterInput.click()" class="h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 cursor-pointer hover:border-blue-400">
                                                <template x-if="wizardData.images?.logoFooter">
                                                    <img :src="wizardData.images.logoFooter" class="max-h-16 object-contain">
                                                </template>
                                                <template x-if="!wizardData.images?.logoFooter">
                                                    <span class="text-xs text-gray-400">+ Logo Footer</span>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="revLogoFooterInput" @change="handleFileUpload($event, 'logoFooter')" accept="image/*" class="hidden">
                                        </div>
                                        <!-- Hero -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Bannière Hero</label>
                                            <div @click="$refs.revHeroInput.click()" class="h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-white cursor-pointer hover:border-blue-400">
                                                <template x-if="wizardData.images?.hero">
                                                    <img :src="wizardData.images.hero" class="max-h-16 object-contain">
                                                </template>
                                                <template x-if="!wizardData.images?.hero">
                                                    <span class="text-xs text-gray-400">+ Hero</span>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="revHeroInput" @change="handleFileUpload($event, 'hero')" accept="image/*" class="hidden">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-4">
                                        <!-- Favicon Clair -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Favicon Clair</label>
                                            <div @click="$refs.revFaviconLightInput.click()" class="h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-white cursor-pointer hover:border-blue-400">
                                                <template x-if="wizardData.images?.faviconLight">
                                                    <img :src="wizardData.images.faviconLight" class="max-h-16 object-contain">
                                                </template>
                                                <template x-if="!wizardData.images?.faviconLight">
                                                    <span class="text-xs text-gray-400">+ Favicon Clair</span>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="revFaviconLightInput" @change="handleFileUpload($event, 'faviconLight')" accept="image/*" class="hidden">
                                        </div>
                                        <!-- Favicon Sombre -->
                                        <div>
                                            <label class="block text-xs font-medium text-gray-600 mb-1">Favicon Sombre</label>
                                            <div @click="$refs.revFaviconDarkInput.click()" class="h-20 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-100 cursor-pointer hover:border-blue-400">
                                                <template x-if="wizardData.images?.faviconDark">
                                                    <img :src="wizardData.images.faviconDark" class="max-h-16 object-contain">
                                                </template>
                                                <template x-if="!wizardData.images?.faviconDark">
                                                    <span class="text-xs text-gray-400">+ Favicon Sombre</span>
                                                </template>
                                            </div>
                                            <input type="file" x-ref="revFaviconDarkInput" @change="handleFileUpload($event, 'faviconDark')" accept="image/*" class="hidden">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <!-- Tab 2: Contenu & Services - Services with their images together -->
                        <div x-show="activeTab === 'content'" x-transition class="space-y-6">
                            <!-- Services Section with Images -->
                            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="text-lg font-semibold text-green-900">🛠️ <span x-text="(wizardData.terminology || 'Services') + ' & Images'"></span></h3>
                                    <button @click="addService()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                        + Ajouter
                                    </button>
                                </div>
                                <div class="space-y-4">
                                    <template x-for="(service, index) in wizardData.services" :key="index">
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white">
                                            <div class="flex gap-4">
                                                <!-- Service Image -->
                                                <div class="flex-shrink-0">
                                                    <label class="block text-xs font-medium text-gray-600 mb-1">Image</label>
                                                    <div @click="$el.parentElement.querySelector('input[type=file]').click()" class="w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50 cursor-pointer hover:border-blue-400">
                                                        <template x-if="wizardData.images?.services?.[index]">
                                                            <img :src="wizardData.images.services[index]" class="w-full h-full object-cover rounded">
                                                        </template>
                                                        <template x-if="!wizardData.images?.services?.[index]">
                                                            <div class="text-center">
                                                                <svg class="w-8 h-8 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                                </svg>
                                                                <span class="text-xs text-gray-400">+ Image</span>
                                                            </div>
                                                        </template>
                                                    </div>
                                                    <input type="file" @change="handleServiceImageUpload($event, index)" accept="image/*" class="hidden">
                                                </div>
                                                <!-- Service Content -->
                                                <div class="flex-1 space-y-3">
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                                        <input type="text" x-model="service.name" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                               placeholder="Ex: Traduction technique">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                                        <textarea x-model="service.description" rows="2"
                                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                  placeholder="Ex: Traduction de documents techniques..."></textarea>
                                                    </div>
                                                    <button @click="removeService(index)" x-show="wizardData.services.length > 1"
                                                            class="text-red-600 hover:text-red-800 text-sm">
                                                        🗑️ Supprimer
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <!-- Content Sub-tabs for Hero, About, Testimonials, FAQ -->
                            <div class="border-b border-gray-200 mb-6">
                                <nav class="-mb-px flex space-x-6">
                                    <button @click="activeContentTab = 'hero'" 
                                            :class="activeContentTab === 'hero' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">Hero</button>
                                    <button @click="activeContentTab = 'about'" 
                                            :class="activeContentTab === 'about' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">À propos</button>
                                    <button @click="activeContentTab = 'testimonials'" 
                                            :class="activeContentTab === 'testimonials' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">Témoignages</button>
                                    <button @click="activeContentTab = 'faq'" 
                                            :class="activeContentTab === 'faq' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500'"
                                            class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">FAQ</button>
                                </nav>
                            </div>

                            <!-- Tab: Hero Content -->
                            <div x-show="activeContentTab === 'hero'" class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-blue-900 mb-4">🏠 Section Hero</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Titre principal</label>
                                            <input type="text" x-model="wizardData.hero.title" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="Ex: Votre partenaire pour une communication internationale">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Sous-titre</label>
                                            <textarea x-model="wizardData.hero.subtitle" rows="2" 
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Ex: Services de traduction professionnelle..."></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                            <textarea x-model="wizardData.hero.description" rows="4" 
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Ex: Nous offrons des services de traduction de haute qualité..."></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Services section has been moved above and combined with images -->

                            <!-- Tab: About -->
                            <div x-show="activeContentTab === 'about'" class="space-y-4">
                                <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                    <h3 class="text-lg font-semibold text-indigo-900 mb-4">ℹ️ À propos de l'entreprise</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Titre de la section</label>
                                            <input type="text" x-model="wizardData.about.title" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   :placeholder="'À propos de ' + wizardData.siteName">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Sous-titre</label>
                                            <textarea x-model="wizardData.about.subtitle" rows="2" 
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Notre expertise au service de votre réussite"></textarea>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Description de l'Entreprise</label>
                                            <textarea x-model="wizardData.about.description" rows="5" 
                                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                      placeholder="Décrivez votre entreprise, son histoire, sa mission..."></textarea>
                                        </div>
                                        <!-- Values (Company Values) -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Valeurs de l'Entreprise</label>
                                            <div class="space-y-2">
                                                <template x-for="(value, index) in (wizardData.about.values = wizardData.about.values || [])" :key="index">
                                                    <div class="flex space-x-2">
                                                        <input type="text" x-model="value.title" 
                                                               placeholder="Nom de la valeur" 
                                                               class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <input type="text" x-model="value.description" 
                                                               placeholder="Description de la valeur" 
                                                               class="flex-2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                        <button @click="wizardData.about.values.splice(index, 1)" 
                                                                class="text-red-600 hover:text-red-800">
                                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </template>
                                                <button @click="wizardData.about.values = wizardData.about.values || []; wizardData.about.values.push({title: '', description: ''})" 
                                                        class="text-sm text-blue-600 hover:text-blue-800">
                                                    + Ajouter une valeur
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tab: Testimonials -->
                            <div x-show="activeContentTab === 'testimonials'" class="space-y-4">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-semibold text-yellow-900">💬 Témoignages clients</h3>
                                        <button @click="addTestimonial()" class="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700">
                                            + Ajouter témoignage
                                        </button>
                                    </div>
                                    <template x-for="(testimonial, index) in (wizardData.testimonials || [])" :key="index">
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white mb-4">
                                            <div class="space-y-3">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Témoignage</label>
                                                    <textarea x-model="testimonial.text" rows="3"
                                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                              placeholder="Le témoignage du client..."></textarea>
                                                </div>
                                                <div class="grid grid-cols-2 gap-3">
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nom</label>
                                                        <input type="text" x-model="testimonial.name" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                               placeholder="Prénom Nom">
                                                    </div>
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700 mb-1">Position</label>
                                                        <input type="text" x-model="testimonial.position" 
                                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                               placeholder="Poste, Entreprise">
                                                    </div>
                                                </div>
                                            </div>
                                            <button @click="removeTestimonial(index)" class="text-red-600 hover:text-red-800 mt-3 text-sm">
                                                🗑️ Supprimer
                                            </button>
                                        </div>
                                    </template>
                                    <div x-show="!wizardData.testimonials || wizardData.testimonials.length === 0" class="text-gray-500 text-center py-8">
                                        Aucun témoignage ajouté. Cliquez sur "+ Ajouter témoignage" pour commencer.
                                    </div>
                                </div>
                            </div>

                            <!-- Tab: FAQ -->
                            <div x-show="activeContentTab === 'faq'" class="space-y-4">
                                <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-semibold text-red-900">❓ Questions fréquentes</h3>
                                        <button @click="addFAQ()" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                            + Ajouter FAQ
                                        </button>
                                    </div>
                                    <template x-for="(item, index) in (wizardData.faq || [])" :key="index">
                                        <div class="border border-gray-200 rounded-lg p-4 bg-white mb-4">
                                            <div class="space-y-3">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Question</label>
                                                    <input type="text" x-model="item.question" 
                                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                           placeholder="Question fréquente...">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-1">Réponse</label>
                                                    <textarea x-model="item.answer" rows="3"
                                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                              placeholder="Réponse détaillée..."></textarea>
                                                </div>
                                            </div>
                                            <button @click="removeFAQ(index)" class="text-red-600 hover:text-red-800 mt-3 text-sm">
                                                🗑️ Supprimer
                                            </button>
                                        </div>
                                    </template>
                                    <div x-show="!wizardData.faq || wizardData.faq.length === 0" class="text-gray-500 text-center py-8">
                                        Aucune FAQ ajoutée. Cliquez sur "+ Ajouter FAQ" pour commencer.
                                    </div>
                                </div>
                            </div>
                        </div>


                        <!-- Tab 3: Blog & Articles with images together -->
                        <div x-show="activeTab === 'blog'" x-transition class="space-y-6">
                            <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold text-indigo-900">📰 Articles de Blog & Images</h3>
                                    <div class="flex space-x-2">
                                        <button @click="addBlogArticle()" class="inline-flex items-center px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                            </svg>
                                            Ajouter Article
                                        </button>
                                        <button class="inline-flex items-center px-3 py-1 bg-purple-600 text-white text-sm rounded-lg hover:bg-purple-700">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                                            </svg>
                                            Générer Articles IA
                                        </button>
                                    </div>
                                </div>
                                
                                <template x-if="!wizardData.blog?.articles || wizardData.blog.articles.length === 0">
                                    <div class="text-center py-8">
                                        <svg class="w-12 h-12 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2.5 2.5 0 00-2.5-2.5H15"></path>
                                        </svg>
                                        <p class="text-gray-600">Aucun article de blog pour le moment</p>
                                        <p class="text-sm text-gray-500">Ajoutez des articles pour améliorer votre référencement</p>
                                    </div>
                                </template>
                                
                                <div x-show="wizardData.blog?.articles && wizardData.blog.articles.length > 0" class="space-y-4">
                                    <template x-for="(article, index) in wizardData.blog?.articles || []" :key="'blog-' + index">
                                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                                            <div class="flex gap-4">
                                                <!-- Article Image -->
                                                <div class="flex-shrink-0">
                                                    <label class="block text-xs font-medium text-gray-600 mb-1">Image</label>
                                                    <div @click="$el.parentElement.querySelector('input[type=file]').click()" class="w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center bg-gray-50 cursor-pointer hover:border-blue-400">
                                                        <template x-if="wizardData.images?.blog?.[index]">
                                                            <img :src="wizardData.images.blog[index]" class="w-full h-full object-cover rounded">
                                                        </template>
                                                        <template x-if="!wizardData.images?.blog?.[index]">
                                                            <div class="text-center">
                                                                <svg class="w-8 h-8 text-gray-400 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                                                </svg>
                                                                <span class="text-xs text-gray-400">+ Image</span>
                                                            </div>
                                                        </template>
                                                    </div>
                                                    <input type="file" @change="handleBlogImageUpload($event, index)" accept="image/*" class="hidden">
                                                </div>
                                                <!-- Article Content -->
                                                <div class="flex-1 space-y-3">
                                                    <div>
                                                        <label class="block text-xs font-medium text-gray-700 mb-1">Titre de l'article</label>
                                                        <input type="text" x-model="article.title" 
                                                               class="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                                                               placeholder="Ex: Les tendances 2024 dans notre secteur">
                                                    </div>
                                                    <div>
                                                        <label class="block text-xs font-medium text-gray-700 mb-1">Résumé</label>
                                                        <textarea x-model="article.excerpt" rows="2" 
                                                                  class="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                                                                  placeholder="Brève description de l'article..."></textarea>
                                                    </div>
                                                    <div>
                                                        <label class="block text-xs font-medium text-gray-700 mb-1">Catégorie</label>
                                                        <input type="text" x-model="article.category" 
                                                               class="w-full px-3 py-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-blue-500"
                                                               placeholder="Ex: Actualités">
                                                    </div>
                                                    <button @click="removeBlogArticle(index)" class="text-red-600 hover:text-red-800 text-sm">
                                                        🗑️ Supprimer
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 4: Contact & Info -->
                        <div x-show="activeTab === 'contact'" x-transition class="space-y-6">
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">📞 Informations de Contact</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input type="email" x-model="wizardData.contact.email" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="contact@mon-entreprise.com">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Téléphone</label>
                                        <input type="tel" x-model="wizardData.contact.phone" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="+33 1 23 45 67 89">
                                    </div>
                                    <div class="col-span-1 md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Adresse</label>
                                        <input type="text" x-model="wizardData.contact.address" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="123 Rue de la République, 75001 Paris">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Horaires d'ouverture</label>
                                        <input type="text" x-model="wizardData.contact.hours" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="Lundi - Vendredi : 9h00 - 18h00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Terminologie technique</label>
                                        <input type="text" x-model="wizardData.terminology" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="services, interventions, cours, activités..."
                                               title="Comment appeler vos services/activités">
                                    </div>
                                </div>
                                
                                <!-- Social Links -->
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Réseaux sociaux</label>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-blue-600">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                                </svg>
                                            </span>
                                            <input type="url" x-model="wizardData.contact.social.facebook" 
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="https://facebook.com/monentreprise">
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-black">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                                                </svg>
                                            </span>
                                            <input type="url" x-model="wizardData.contact.social.twitter" 
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="https://twitter.com/monentreprise">
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-pink-600">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zM5.838 12a6.162 6.162 0 1112.324 0 6.162 6.162 0 01-12.324 0zM12 16a4 4 0 110-8 4 4 0 010 8zm4.965-10.405a1.44 1.44 0 112.881.001 1.44 1.44 0 01-2.881-.001z"/>
                                                </svg>
                                            </span>
                                            <input type="url" x-model="wizardData.contact.social.instagram" 
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="https://instagram.com/monentreprise">
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-blue-700">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                </svg>
                                            </span>
                                            <input type="url" x-model="wizardData.contact.social.linkedin" 
                                                   class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                   placeholder="https://linkedin.com/company/monentreprise">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SEO Settings -->
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-purple-900 mb-4">🔍 Référencement SEO</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Titre SEO</label>
                                        <input type="text" x-model="wizardData.seo.title" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="Titre de la page pour les moteurs de recherche (max 60 caractères)">
                                        <div class="text-xs text-gray-500 mt-1" x-text="(wizardData.seo.title || '').length + '/60 caractères'"></div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Description SEO</label>
                                        <textarea x-model="wizardData.seo.description" rows="2" 
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                  placeholder="Description de votre site pour les moteurs de recherche (150-160 caractères)"></textarea>
                                        <div class="text-xs text-gray-500 mt-1" x-text="(wizardData.seo.description || '').length + '/160 caractères'"></div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Mots-clés</label>
                                        <input type="text" x-model="wizardData.seo.keywords" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="mot-clé1, mot-clé2, mot-clé3">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Tab 5: Summary & Creation -->
                        <div x-show="activeTab === 'summary'" x-transition class="space-y-6">
                            <!-- Configuration Summary -->
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">📋 Résumé de Configuration</h3>
                                
                                <!-- Basic Info Summary -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-700 mb-2">Informations de Base</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li><span class="font-medium">Site:</span> <span x-text="wizardData.siteName"></span></li>
                                            <li><span class="font-medium">Type:</span> <span x-text="wizardData.businessType"></span></li>
                                            <li><span class="font-medium">Domaine:</span> <span x-text="wizardData.domain"></span></li>
                                            <li><span class="font-medium">Terminologie:</span> <span x-text="wizardData.terminology || 'services'"></span></li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="text-sm font-medium text-gray-700 mb-2">Contenu</h4>
                                        <ul class="text-sm text-gray-600 space-y-1">
                                            <li><span x-text="(wizardData.terminology || 'Services') + ': '"></span><span x-text="wizardData.services.length"></span></li>
                                            <li>Témoignages: <span x-text="(wizardData.testimonials || []).length"></span></li>
                                            <li>FAQ: <span x-text="(wizardData.faq || []).length"></span></li>
                                            <li>Articles Blog: <span x-text="(wizardData.blog?.articles || []).length"></span></li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <!-- Features Summary -->
                                <div class="border-t border-gray-200 pt-4">
                                    <h4 class="text-sm font-medium text-gray-700 mb-2">Fonctionnalités Activées</h4>
                                    <div class="flex flex-wrap gap-2">
                                        <span x-show="wizardData.features.blog" class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">Blog</span>
                                        <span x-show="wizardData.features.newsletter" class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">Newsletter</span>
                                        <span x-show="wizardData.seo.description" class="px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full">SEO Optimisé</span>
                                        <span x-show="wizardData.logo" class="px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full">Logo Uploadé</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Template Saving Option -->
                            <div class="border border-gray-200 rounded-lg p-6 bg-blue-50">
                                <h3 class="font-semibold mb-2 text-blue-900">💾 Option de Sauvegarde Template</h3>
                                <p class="text-sm text-gray-600 mb-4">
                                    Cette option vous permet de sauvegarder votre configuration actuelle (couleurs, structure, fonctionnalités) 
                                    comme un modèle réutilisable pour créer rapidement d'autres sites similaires. 
                                    Le site sera créé normalement, et le template sera disponible pour une utilisation future.
                                </p>
                                <label class="flex items-center mb-3">
                                    <input type="checkbox" x-model="wizardData.saveAsTemplate" class="mr-2">
                                    <span class="text-sm font-medium">Sauvegarder cette configuration comme template réutilisable</span>
                                </label>
                                <div x-show="wizardData.saveAsTemplate" x-transition class="space-y-3 mt-4 pl-6 border-l-2 border-blue-300">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nom du template</label>
                                        <input type="text" x-model="wizardData.templateName" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="Ex: Template Plomberie Pro">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Description du template</label>
                                        <textarea x-model="wizardData.templateDescription" rows="2" 
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                  placeholder="Template complet pour site de plomberie avec services, FAQ et témoignages"></textarea>
                                    </div>
                                    <div class="text-xs text-blue-700 bg-blue-100 p-2 rounded">
                                        ℹ️ Les informations personnelles (emails, téléphones, domaines) seront retirées du template.
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Creation Options -->
                            <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold text-green-900 mb-4">🚀 Options de Création</h3>
                                <div class="space-y-3">
                                    <label class="flex items-center">
                                        <input type="radio" name="deployOption" x-model="wizardData.deployOption" value="create" class="mr-2" checked>
                                        <span class="text-sm">Créer le site uniquement</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="deployOption" x-model="wizardData.deployOption" value="deploy" class="mr-2">
                                        <span class="text-sm">Créer et déployer immédiatement</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex justify-between mt-8">
                        <button @click="prevStep()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            ← Précédent
                        </button>
                        <div x-show="activeTab !== 'summary'">
                            <button @click="activeTab = 'summary'" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                Continuer vers Création →
                            </button>
                        </div>
                        <div x-show="activeTab === 'summary'" class="space-x-3">
                            <button @click="createSite(false)" 
                                    :disabled="isCreating"
                                    :class="[
                                        'px-8 py-3 rounded-lg font-medium transition-colors',
                                        isCreating 
                                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed' 
                                            : 'bg-green-600 text-white hover:bg-green-700'
                                    ]"
                                    x-text="isCreating ? 'Création en cours...' : '🚀 Créer le Site'">
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Advanced Features & Integrations -->
                <div x-show="currentStep === 5" x-transition class="wizard-step p-8" x-data="{ 
                    activeFeatureTab: 'integrations',
                    showApiKeyHelp: false 
                }">
                    <h2 class="text-2xl font-bold mb-6">🚀 Fonctionnalités Avancées & Intégrations</h2>
                    <p class="text-gray-600 mb-8">Configurez les fonctionnalités avancées et les intégrations tierces pour votre site</p>

                    <!-- Feature Tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-8">
                            <button @click="activeFeatureTab = 'integrations'" 
                                    :class="activeFeatureTab === 'integrations' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                🔌 Intégrations
                            </button>
                            <button @click="activeFeatureTab = 'analytics'" 
                                    :class="activeFeatureTab === 'analytics' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                📊 Analytics
                            </button>
                            <button @click="activeFeatureTab = 'performance'" 
                                    :class="activeFeatureTab === 'performance' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                ⚡ Performance
                            </button>
                            <button @click="activeFeatureTab = 'security'" 
                                    :class="activeFeatureTab === 'security' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                                    class="whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm">
                                🔒 Sécurité
                            </button>
                        </nav>
                    </div>

                    <!-- Tab Contents -->
                    <div class="space-y-6">
                        
                        <!-- Integrations Tab -->
                        <div x-show="activeFeatureTab === 'integrations'" x-transition>
                            
                            <!-- Newsletter Integration -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">📧 Newsletter</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.newsletter.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.newsletter.enabled" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Fournisseur</label>
                                        <select x-model="wizardData.integrations.newsletter.provider" 
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="n8n">N8N avec Gmail (Gratuit)</option>
                                            <option value="mailchimp">Mailchimp</option>
                                            <option value="sendgrid">SendGrid</option>
                                            <option value="custom">Personnalisé</option>
                                        </select>
                                    </div>
                                    
                                    <!-- N8N with Gmail configuration -->
                                    <div x-show="wizardData.integrations.newsletter.provider === 'n8n'" class="bg-blue-50 p-3 rounded">
                                        <p class="text-sm text-blue-900 font-medium mb-2">📧 Configuration Gmail requise:</p>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.newsletter.hasGoogleAccount" class="mr-2">
                                                <span class="text-sm">J'ai un compte Google/Gmail</span>
                                            </label>
                                            <div x-show="wizardData.integrations.newsletter.hasGoogleAccount">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">Email Gmail</label>
                                                <input type="email" x-model="wizardData.integrations.newsletter.gmailAddress" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="votre-email@gmail.com">
                                                <label class="block text-sm font-medium text-gray-700 mb-1 mt-2">Mot de passe d'application</label>
                                                <input type="password" x-model="wizardData.integrations.newsletter.gmailAppPassword" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="xxxx xxxx xxxx xxxx">
                                                <p class="text-xs text-gray-600 mt-1">
                                                    <a href="https://myaccount.google.com/apppasswords" target="_blank" class="text-blue-600 underline">
                                                        Créer un mot de passe d'application →
                                                    </a>
                                                </p>
                                            </div>
                                            <div x-show="!wizardData.integrations.newsletter.hasGoogleAccount">
                                                <button @click="createGoogleAccountTask()" type="button"
                                                        class="text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
                                                    🎯 Demander création compte Gmail
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div x-show="wizardData.integrations.newsletter.provider === 'mailchimp'">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Clé API Mailchimp</label>
                                        <input type="text" x-model="wizardData.integrations.newsletter.apiKey" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="Votre clé API Mailchimp">
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="wizardData.integrations.newsletter.welcomeEmail" class="mr-2">
                                            <span class="text-sm">Email de bienvenue</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="wizardData.integrations.newsletter.doubleOptIn" class="mr-2">
                                            <span class="text-sm">Double opt-in</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- WhatsApp Business -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">💬 WhatsApp Business</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.whatsapp.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.whatsapp.enabled" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Numéro WhatsApp</label>
                                        <input type="tel" x-model="wizardData.integrations.whatsapp.number" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="+33 6 12 34 56 78">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Message par défaut</label>
                                        <textarea x-model="wizardData.integrations.whatsapp.message" rows="2"
                                                  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                  placeholder="Bonjour, je souhaite plus d'informations sur vos services"></textarea>
                                    </div>
                                </div>
                            </div>

                            <!-- Live Chat -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">💭 Chat en Direct</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.liveChat.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.liveChat.enabled" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Fournisseur</label>
                                        <select x-model="wizardData.integrations.liveChat.provider" 
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="crisp">Crisp</option>
                                            <option value="tawkto">Tawk.to (Gratuit)</option>
                                            <option value="intercom">Intercom</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Widget ID</label>
                                        <input type="text" x-model="wizardData.integrations.liveChat.widgetId" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="ID du widget de chat">
                                    </div>
                                </div>
                            </div>

                            <!-- Google Maps -->
                            <div class="border border-gray-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">📍 Google Maps</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.googleMaps.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.googleMaps.enabled" class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Clé API Google Maps</label>
                                        <input type="text" x-model="wizardData.integrations.googleMaps.apiKey" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="AIzaSy...">
                                        <p class="text-xs text-gray-500 mt-1">Requis pour afficher une carte sur votre site</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Calendly Integration -->
                            <div class="border border-gray-200 rounded-lg p-6 mt-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">📅 Calendly - Prise de RDV</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.calendly.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.calendly.enabled" class="space-y-4">
                                    <div class="bg-blue-50 p-3 rounded">
                                        <p class="text-sm text-blue-900 mb-2">Configuration Calendly:</p>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.calendly.hasAccount" class="mr-2">
                                                <span class="text-sm">J'ai un compte Calendly</span>
                                            </label>
                                            <div x-show="wizardData.integrations.calendly.hasAccount">
                                                <label class="block text-sm font-medium text-gray-700 mb-1">URL Calendly</label>
                                                <input type="url" x-model="wizardData.integrations.calendly.url" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="https://calendly.com/votre-nom">
                                                <p class="text-xs text-gray-600 mt-1">Votre lien de planification Calendly</p>
                                            </div>
                                            <div x-show="!wizardData.integrations.calendly.hasAccount">
                                                <button @click="requestAdminHelp('calendly')" type="button"
                                                        class="text-sm bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600">
                                                    🆘 Demander aide configuration Calendly
                                                </button>
                                                <p class="text-xs text-gray-600 mt-1">Un expert vous aidera à configurer Calendly</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Type d'intégration</label>
                                        <select x-model="wizardData.integrations.calendly.type" 
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="inline">Widget intégré</option>
                                            <option value="popup">Popup sur clic</option>
                                            <option value="button">Bouton flottant</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Analytics Tab -->
                        <div x-show="activeFeatureTab === 'analytics'" x-transition>
                            
                            <!-- Google Analytics -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">📈 Google Analytics 4</h3>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Gratuit</span>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Measurement ID</label>
                                        <input type="text" x-model="wizardData.integrations.analytics.googleAnalytics" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="G-XXXXXXXXXX">
                                        <p class="text-xs text-gray-500 mt-1">Format: G-XXXXXXXXXX</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Facebook Pixel -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">📘 Facebook Pixel</h3>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Gratuit</span>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Pixel ID</label>
                                        <input type="text" x-model="wizardData.integrations.analytics.facebookPixel" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="1234567890123456">
                                    </div>
                                </div>
                            </div>

                            <!-- Google Tag Manager -->
                            <div class="border border-gray-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">🏷️ Google Tag Manager</h3>
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Gratuit</span>
                                </div>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Container ID</label>
                                        <input type="text" x-model="wizardData.integrations.analytics.googleTagManager" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                               placeholder="GTM-XXXXXXX">
                                        <p class="text-xs text-gray-500 mt-1">Format: GTM-XXXXXXX</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Performance Tab -->
                        <div x-show="activeFeatureTab === 'performance'" x-transition>
                            
                            <!-- Image Optimization -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <h3 class="text-lg font-semibold mb-4">🖼️ Optimisation des Images</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Qualité des images</label>
                                        <div class="flex items-center space-x-4">
                                            <input type="range" x-model="wizardData.integrations.performance.imageQuality" 
                                                   min="60" max="100" step="5"
                                                   class="flex-1">
                                            <span class="text-sm font-medium w-12" x-text="wizardData.integrations.performance.imageQuality + '%'"></span>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">Plus bas = fichiers plus légers, Plus haut = meilleure qualité</p>
                                    </div>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="wizardData.integrations.performance.lazyLoading" class="mr-2">
                                            <span class="text-sm">Chargement différé (Lazy Loading)</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" x-model="wizardData.integrations.performance.webp" class="mr-2">
                                            <span class="text-sm">Conversion automatique en WebP</span>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Caching & CDN -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <h3 class="text-lg font-semibold mb-4">🚀 Cache & CDN</h3>
                                <div class="space-y-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.performance.browserCaching" class="mr-2">
                                        <span class="text-sm">Activer le cache navigateur</span>
                                    </label>
                                    <div>
                                        <label class="flex items-center mb-2">
                                            <input type="checkbox" x-model="wizardData.integrations.performance.cdnEnabled" class="mr-2">
                                            <span class="text-sm">Utiliser un CDN</span>
                                        </label>
                                        <div x-show="wizardData.integrations.performance.cdnEnabled" class="ml-6">
                                            <select x-model="wizardData.integrations.performance.cdnProvider" 
                                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="">Sélectionner un CDN</option>
                                                <option value="cloudflare">Cloudflare (Gratuit)</option>
                                                <option value="bunny">BunnyCDN</option>
                                                <option value="custom">Personnalisé</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Minification -->
                            <div class="border border-gray-200 rounded-lg p-6">
                                <h3 class="text-lg font-semibold mb-4">📦 Minification</h3>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.performance.minifyHTML" class="mr-2">
                                        <span class="text-sm">Minifier HTML</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.performance.minifyCSS" class="mr-2">
                                        <span class="text-sm">Minifier CSS</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.performance.minifyJS" class="mr-2">
                                        <span class="text-sm">Minifier JavaScript</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Security Tab -->
                        <div x-show="activeFeatureTab === 'security'" x-transition>
                            
                            <!-- SSL & HTTPS -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <h3 class="text-lg font-semibold mb-4">🔒 SSL & HTTPS</h3>
                                <div class="space-y-4">
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.security.forceSSL" checked disabled class="mr-2">
                                        <span class="text-sm">Forcer HTTPS (Toujours activé)</span>
                                    </label>
                                    <div class="bg-green-50 p-3 rounded">
                                        <p class="text-sm text-green-800">✅ Certificat SSL inclus gratuitement avec Let's Encrypt</p>
                                    </div>
                                </div>
                            </div>

                            <!-- GDPR & Privacy -->
                            <div class="border border-gray-200 rounded-lg p-6 mb-4">
                                <h3 class="text-lg font-semibold mb-4">🛡️ RGPD & Confidentialité</h3>
                                <div class="space-y-4">
                                    <!-- RGPD Mode Selection -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Mode RGPD</label>
                                        <div class="flex space-x-4">
                                            <label class="flex items-center">
                                                <input type="radio" x-model="wizardData.integrations.security.rgpdMode" value="default" class="mr-2">
                                                <span class="text-sm">Utiliser les textes par défaut</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="radio" x-model="wizardData.integrations.security.rgpdMode" value="custom" class="mr-2">
                                                <span class="text-sm">Personnaliser</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- RGPD Options (always enabled) -->
                                    <div class="bg-green-50 p-3 rounded">
                                        <p class="text-sm text-green-800 mb-2">✅ Activé par défaut (obligatoire RGPD):</p>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.security.cookieBanner" checked disabled class="mr-2">
                                                <span class="text-sm">Bannière de cookies</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.security.privacyPolicy" checked disabled class="mr-2">
                                                <span class="text-sm">Page politique de confidentialité</span>
                                            </label>
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.security.termsOfService" checked disabled class="mr-2">
                                                <span class="text-sm">Page conditions d'utilisation</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <!-- Custom Text Areas (only shown if custom mode) -->
                                    <div x-show="wizardData.integrations.security.rgpdMode === 'custom'" class="space-y-3">
                                        <p class="text-sm text-gray-600">Vous pourrez personnaliser les textes légaux dans l'étape suivante.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- CAPTCHA -->
                            <div class="border border-gray-200 rounded-lg p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-semibold">🤖 Protection Anti-Spam (reCAPTCHA v2)</h3>
                                    <label class="flex items-center">
                                        <input type="checkbox" x-model="wizardData.integrations.security.captcha.enabled" class="mr-2">
                                        <span class="text-sm">Activer</span>
                                    </label>
                                </div>
                                <div x-show="wizardData.integrations.security.captcha.enabled" class="space-y-4">
                                    <!-- Google Account Check -->
                                    <div class="bg-blue-50 p-4 rounded-lg">
                                        <h4 class="font-medium text-blue-900 mb-2">📌 Configuration requise:</h4>
                                        <div class="space-y-2">
                                            <label class="flex items-center">
                                                <input type="checkbox" x-model="wizardData.integrations.security.captcha.hasGoogleAccount" class="mr-2">
                                                <span class="text-sm">J'ai un compte Google</span>
                                            </label>
                                            <div x-show="!wizardData.integrations.security.captcha.hasGoogleAccount" class="ml-6">
                                                <button @click="createGoogleAccountTask()" 
                                                        type="button"
                                                        class="text-sm bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700">
                                                    🎯 Demander création compte Google
                                                </button>
                                                <p class="text-xs text-gray-600 mt-1">Un admin créera le compte pour vous</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Provider Selection -->
                                    <div x-show="wizardData.integrations.security.captcha.hasGoogleAccount">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Type de reCAPTCHA</label>
                                        <select x-model="wizardData.integrations.security.captcha.provider" 
                                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="recaptcha-v2">Google reCAPTCHA v2 (Recommandé)</option>
                                            <option value="recaptcha-v3">Google reCAPTCHA v3</option>
                                            <option value="hcaptcha">hCaptcha</option>
                                        </select>
                                    </div>

                                    <!-- Key Configuration -->
                                    <div x-show="wizardData.integrations.security.captcha.hasGoogleAccount">
                                        <div class="space-y-3">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Site Key (Clé publique)</label>
                                                <input type="text" x-model="wizardData.integrations.security.captcha.siteKey" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="6Lc...">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Secret Key (Clé secrète)</label>
                                                <input type="password" x-model="wizardData.integrations.security.captcha.secretKey" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                       placeholder="6Lc...">
                                            </div>
                                        </div>
                                        
                                        <!-- Help Section -->
                                        <div class="mt-3 p-3 bg-gray-50 rounded text-xs text-gray-600">
                                            <p class="font-medium mb-1">🔑 Comment obtenir les clés reCAPTCHA:</p>
                                            <ol class="list-decimal ml-4 space-y-1">
                                                <li>Allez sur <a href="https://www.google.com/recaptcha/admin" target="_blank" class="text-blue-600 underline">Google reCAPTCHA Admin</a></li>
                                                <li>Créez un nouveau site avec votre domaine</li>
                                                <li>Choisissez reCAPTCHA v2 (case "Je ne suis pas un robot")</li>
                                                <li>Copiez les clés site et secrète ici</li>
                                            </ol>
                                            <button @click="requestAdminHelp('captcha')" 
                                                    type="button"
                                                    class="mt-2 text-sm bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600">
                                                🆘 Demander l'aide d'un admin
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="flex justify-between mt-8">
                        <button @click="prevStep()" class="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Précédent</button>
                        <button @click="nextStep()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">Suivant</button>
                    </div>
                </div>

                <!-- Step 8: Creation Result -->
                <div x-show="currentStep === 7 && creationResult" x-transition class="wizard-step p-8">
                    <div class="text-center max-w-2xl mx-auto">
                        <template x-if="creationResult.success">
                            <div>
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-4" x-text="text.result.success.title"></h2>
                                <p class="text-lg text-gray-600 mb-8" x-text="text.result.success.message"></p>
                                
                                <div class="bg-gray-50 p-6 rounded-lg mb-8">
                                    <h3 class="font-semibold mb-4" x-text="text.result.success.details"></h3>
                                    <div class="text-left space-y-2 text-sm">
                                        <p><span class="font-medium" x-text="text.result.success.siteId + ':'"></span> <span x-text="creationResult.siteId"></span></p>
                                        <p x-show="creationResult.template"><span class="font-medium" x-text="text.result.success.template + ':'"></span> <span x-text="creationResult.template"></span></p>
                                        <p><span class="font-medium" x-text="text.result.success.status + ':'"></span> <span x-text="creationResult.deployed ? '✅ Déployé' : text.result.success.ready"></span></p>
                                        <p x-show="creationResult.deployed && creationResult.siteUrl">
                                            <span class="font-medium">URL:</span> 
                                            <a :href="creationResult.siteUrl" target="_blank" class="text-blue-600 hover:underline" x-text="creationResult.siteUrl"></a>
                                        </p>
                                        <p x-show="creationResult.deployed && creationResult.port">
                                            <span class="font-medium">Port:</span> <span x-text="creationResult.port"></span>
                                        </p>
                                    </div>
                                </div>

                                <div class="space-x-4">
                                    <button @click="viewSite()" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-medium" x-text="text.result.success.view"></button>
                                    <button @click="openDashboard()" class="border border-gray-300 px-8 py-3 rounded-lg hover:bg-gray-50 font-medium" x-text="text.result.success.dashboard"></button>
                                </div>
                            </div>
                        </template>

                        <template x-if="!creationResult.success">
                            <div>
                                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-900 mb-4" x-text="text.result.error.title"></h2>
                                <p class="text-lg text-gray-600 mb-8" x-text="text.result.error.message"></p>
                                
                                <div class="bg-red-50 p-6 rounded-lg mb-8">
                                    <h3 class="font-semibold text-red-900 mb-2" x-text="text.result.error.details"></h3>
                                    <p class="text-sm text-red-800" x-text="creationResult.error"></p>
                                </div>

                                <div class="space-x-4">
                                    <button @click="currentStep = 7" class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 font-medium" x-text="text.result.error.retry"></button>
                                    <button @click="currentStep = 0" class="border border-gray-300 px-8 py-3 rounded-lg hover:bg-gray-50 font-medium" x-text="text.result.error.restart"></button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function enhancedWizardApp() {
            return {
                currentStep: 0,
                language: 'fr',
                showHelp: false,
                showTemplatePreview: null,
                showGeneratedPreview: false,
                isCreating: false,
                availableTemplates: [], // Initialize as empty array
                selectedTemplateData: null,
                
                // Enhanced steps structure - USER PERSPECTIVE NUMBERING
                // User sees: Step 1=Bienvenue, Step 2=Modèle, Step 3=Informations, Step 4=Contenu, Step 5=Images, Step 6=Révision
                steps: [
                    { title: 'Step 1: Bienvenue', completed: false },      // currentStep === 0
                    { title: 'Step 2: Modèle', completed: false },         // currentStep === 1
                    { title: 'Step 3: Informations', completed: false },   // currentStep === 2
                    { title: 'Step 4: Contenu', completed: false },        // currentStep === 3
                    { title: 'Step 5: Images', completed: false },         // currentStep === 4
                    { title: 'Step 6: Fonctionnalités', completed: false }, // currentStep === 5
                    { title: 'Step 7: Révision & Création', completed: false } // currentStep === 6
                ],

                // Comprehensive wizard data
                wizardData: {
                    currentStep: 0, // Add currentStep to wizardData for consistency
                    siteLanguage: 'fr', // Language for the generated website
                    termsAccepted: false,
                    selectedTemplate: 'custom',
                    siteName: '',
                    businessType: '',
                    businessDescription: '',
                    domain: '',
                    slogan: '',
                    // Step 3: Images & Logo
                    imageApproach: '', // 'manual', 'ai', 'mixed'
                    images: {
                        logo: null,          // Logo navbar (clair)
                        logoFooter: null,    // Logo footer (sombre)
                        hero: null,          // Image hero
                        faviconLight: null,  // Favicon clair
                        faviconDark: null,   // Favicon sombre
                        services: []
                    },
                    aiStyle: 'modern',
                    imageChoices: {
                        logo: 'upload',         // Logo navbar (clair)
                        logoFooter: 'upload',   // Logo footer (sombre)
                        hero: 'upload',         // Image hero
                        faviconLight: 'upload', // Favicon clair
                        faviconDark: 'upload'   // Favicon sombre
                    },
                    logo: null,
                    selectedColorPalette: 'blue',
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#60A5FA',
                        accent: '#93C5FD'
                    },
                    services: [
                        { name: '', description: '', id: 1 }
                    ],
                    hero: {
                        title: '',
                        subtitle: '',
                        description: ''
                    },
                    about: {
                        title: '',
                        subtitle: '',
                        description: '',
                        values: []
                    },
                    testimonials: [],
                    faq: [],
                    servicesPage: {
                        subtitle: '',
                        ctaTitle: '',
                        ctaDescription: ''
                    },
                    contact: {
                        email: '',
                        phone: '',
                        address: '',
                        hours: '',
                        social: {
                            facebook: '',
                            twitter: '',
                            instagram: '',
                            linkedin: ''
                        }
                    },
                    features: {
                        blog: false,
                        newsletter: false
                    },
                    blog: {
                        categories: '',
                        initialPosts: '3',
                        articles: []
                    },
                    terminology: 'services',
                    seo: {
                        title: '',
                        description: '',
                        keywords: ''
                    },
                    saveAsTemplate: false,
                    templateName: '',
                    templateDescription: '',
                    deployOption: 'create', // 'create' or 'deploy'
                    // Advanced features & integrations
                    integrations: {
                        newsletter: {
                            enabled: false,
                            provider: 'n8n',
                            apiKey: '',
                            listId: '',
                            welcomeEmail: true,
                            doubleOptIn: false
                        },
                        whatsapp: {
                            enabled: false,
                            number: '',
                            message: ''
                        },
                        liveChat: {
                            enabled: false,
                            provider: 'tawkto',
                            widgetId: ''
                        },
                        googleMaps: {
                            enabled: false,
                            apiKey: ''
                        },
                        calendly: {
                            enabled: false,
                            hasAccount: false,
                            url: '',
                            type: 'inline' // 'inline', 'popup', or 'button'
                        },
                        analytics: {
                            googleAnalytics: '',
                            facebookPixel: '',
                            googleTagManager: ''
                        },
                        performance: {
                            imageQuality: 85,
                            lazyLoading: true,
                            webp: false,
                            browserCaching: true,
                            cdnEnabled: false,
                            cdnProvider: '',
                            minifyHTML: true,
                            minifyCSS: true,
                            minifyJS: true
                        },
                        security: {
                            forceSSL: true,
                            cookieBanner: true,
                            privacyPolicy: true,
                            termsOfService: true,
                            rgpdMode: 'default', // 'default' or 'custom'
                            captcha: {
                                enabled: false,
                                provider: 'recaptcha-v2',
                                siteKey: '',
                                secretKey: '',
                                hasGoogleAccount: false
                            }
                        }
                    }
                },

                // Generated content for review
                generatedContent: {
                    hero: {
                        title: '',
                        subtitle: '',
                        description: ''
                    }
                },

                // AI Request tracking
                aiRequest: {
                    id: null,
                    status: null, // 'pending', 'assigned', 'processing', 'completed', 'rejected'
                    generatedContent: null,
                    estimatedCost: 2.00,
                    pollInterval: null,
                    timerInterval: null,
                    startTime: null,
                    elapsedTime: '00:00'
                },
                
                // Image AI Request tracking
                imageAiRequest: {
                    id: null,
                    status: null,
                    generatedImages: null,
                    pollInterval: null
                },

                // Creation result
                creationResult: {
                    success: false,
                    siteId: '',
                    template: '',
                    error: ''
                },

                // Enhanced business types with terminology
                businessTypes: {
                    translation: {
                        name: 'Services de Traduction',
                        description: 'Services professionnels de traduction et localisation',
                        terminology: 'services',
                        colors: { primary: '#059669', secondary: '#10B981', accent: '#34D399' }
                    },
                    education: {
                        name: 'Éducation et Formation',
                        description: 'Établissements d\'enseignement et centres de formation',
                        terminology: 'cours',
                        colors: { primary: '#3B82F6', secondary: '#60A5FA', accent: '#93C5FD' }
                    },
                    creative: {
                        name: 'Services Créatifs',
                        description: 'Design, art, et services créatifs',
                        terminology: 'créations',
                        colors: { primary: '#8B5CF6', secondary: '#A78BFA', accent: '#C4B5FD' }
                    },
                    business: {
                        name: 'Conseil en Entreprise',
                        description: 'Consulting et services aux entreprises',
                        terminology: 'services',
                        colors: { primary: '#1F2937', secondary: '#4B5563', accent: '#6B7280' }
                    },
                    plumbing: {
                        name: 'Plomberie',
                        description: 'Services de plomberie et réparations',
                        terminology: 'interventions',
                        colors: { primary: '#0891B2', secondary: '#06B6D4', accent: '#22D3EE' }
                    },
                    restaurant: {
                        name: 'Restaurant et Gastronomie',
                        description: 'Restaurants, cafés, et services de restauration',
                        terminology: 'spécialités',
                        colors: { primary: '#DC2626', secondary: '#EF4444', accent: '#F87171' }
                    }
                },

                // Color palettes
                colorPalettes: {
                    blue: { primary: '#3B82F6', secondary: '#60A5FA', accent: '#93C5FD' },
                    green: { primary: '#059669', secondary: '#10B981', accent: '#34D399' },
                    purple: { primary: '#8B5CF6', secondary: '#A78BFA', accent: '#C4B5FD' },
                    red: { primary: '#DC2626', secondary: '#EF4444', accent: '#F87171' },
                    gray: { primary: '#1F2937', secondary: '#4B5563', accent: '#6B7280' },
                    cyan: { primary: '#0891B2', secondary: '#06B6D4', accent: '#22D3EE' }
                },

                // Computed property for current language text
                get text() {
                    return this.translations[this.language] || this.translations.fr;
                },

                // Multilingual text content
                translations: {
                    fr: {
                        common: {
                            next: 'Suivant',
                            previous: 'Précédent',
                            close: 'Fermer',
                            start: 'Commencer',
                            remove: 'Supprimer',
                            enabled: 'Activé',
                            uploaded: 'Téléchargé'
                        },
                        help: {
                            title: 'Aide de l\'assistant',
                            navigation: '• Utilisez les boutons Suivant/Précédent pour naviguer',
                            autosave: '• Votre progression est automatiquement sauvegardée',
                            optional: '• Vous pouvez ignorer les étapes optionnelles',
                            review: '• Vérifiez tous les paramètres avant la création finale'
                        },
                        welcome: {
                            title: 'Bienvenue dans l\'Assistant de Création de Site',
                            subtitle: 'Créez votre site web professionnel en quelques étapes simples',
                            language: 'Choisissez votre langue',
                            terms: {
                                title: 'Conditions d\'utilisation',
                                item1: '• Vos données sont traitées de manière sécurisée',
                                item2: '• Vous conservez tous les droits sur votre contenu',
                                item3: '• Le site généré vous appartient entièrement',
                                accept: 'J\'accepte les conditions d\'utilisation'
                            }
                        },
                        template: {
                            title: 'Choisissez un Modèle',
                            subtitle: 'Sélectionnez un modèle de base ou créez le vôtre',
                            custom: {
                                title: 'Modèle Personnalisé',
                                description: 'Créez votre site à partir de zéro'
                            },
                            preview: 'Aperçu du modèle',
                            previewColors: 'Couleurs',
                            previewFeatures: 'Fonctionnalités',
                            features: {
                                blog: 'Blog intégré',
                                testimonials: 'Témoignages',
                                faq: 'Questions fréquentes'
                            }
                        },
                        business: {
                            title: 'Informations sur votre Entreprise',
                            siteName: 'Nom du site',
                            siteNamePlaceholder: 'Mon Entreprise',
                            businessType: 'Type d\'activité',
                            selectBusinessType: 'Sélectionnez votre secteur',
                            domain: 'Nom de domaine',
                            domainPlaceholder: 'mon-entreprise.com',
                            slogan: 'Slogan',
                            sloganPlaceholder: 'Votre slogan accrocheur',
                            typeInfo: 'Informations sur ce secteur',
                            terminology: 'Terminologie utilisée: '
                        },
                        branding: {
                            title: 'Identité et Branding',
                            logo: {
                                title: 'Logo de votre entreprise',
                                upload: 'Cliquez ou glissez votre logo ici',
                                formats: 'PNG, JPG, SVG (max 2MB)',
                                uploaded: 'Logo téléchargé avec succès'
                            },
                            colors: {
                                title: 'Palette de couleurs',
                                custom: 'Couleurs personnalisées',
                                primary: 'Primaire',
                                secondary: 'Secondaire',
                                accent: 'Accent'
                            }
                        },
                        images: {
                            title: 'Images et Assets',
                            subtitle: 'Téléchargez les images et logos pour votre site',
                            approach: 'Choisissez votre approche pour les images'
                        },
                        content: {
                            title: 'Contenu et Activités',
                            activities: {
                                title: 'Vos activités',
                                default: 'activités',
                                add: 'Ajouter une activité',
                                name: 'Nom de l\'activité',
                                namePlaceholder: 'Ex: Traduction de documents',
                                description: 'Description',
                                descriptionPlaceholder: 'Décrivez cette activité en quelques mots'
                            },
                            contact: {
                                title: 'Informations de contact',
                                email: 'Email',
                                emailPlaceholder: 'contact@mon-entreprise.com',
                                phone: 'Téléphone',
                                phonePlaceholder: '+33 1 23 45 67 89',
                                address: 'Adresse',
                                addressPlaceholder: '123 Rue de la République, 75001 Paris'
                            }
                        },
                        review: {
                            title: 'Révision du Contenu',
                            subtitle: 'Vérifiez et modifiez le contenu généré pour votre site',
                            preview: {
                                title: 'Aperçu du contenu généré',
                                activities: 'Vos activités'
                            },
                            edit: {
                                title: 'Modifier le contenu',
                                heroTitle: 'Titre principal',
                                heroSubtitle: 'Sous-titre',
                                heroDescription: 'Description'
                            },
                            regenerate: 'Régénérer le contenu'
                        },
                        advanced: {
                            title: 'Fonctionnalités Avancées',
                            subtitle: 'Configurez les fonctionnalités supplémentaires de votre site',
                            blog: {
                                title: 'Blog',
                                enable: 'Activer le blog',
                                categories: 'Catégories du blog',
                                categoriesPlaceholder: 'Actualités, Conseils, Guides',
                                initialPosts: 'Articles initiaux'
                            },
                            newsletter: {
                                title: 'Newsletter',
                                enable: 'Activer la newsletter',
                                description: 'Permet aux visiteurs de s\'inscrire à votre newsletter'
                            },
                            seo: {
                                title: 'Référencement SEO',
                                description: 'Description SEO',
                                descriptionPlaceholder: 'Description de votre site pour les moteurs de recherche',
                                keywords: 'Mots-clés',
                                keywordsPlaceholder: 'mot-clé1, mot-clé2, mot-clé3'
                            }
                        },
                        final: {
                            title: 'Révision Finale et Création',
                            subtitle: 'Vérifiez tous vos paramètres avant de créer votre site',
                            summary: {
                                title: 'Résumé de la configuration',
                                basic: 'Informations de base',
                                features: 'Fonctionnalités'
                            },
                            template: {
                                title: 'Sauvegarder comme modèle',
                                save: 'Sauvegarder cette configuration comme modèle réutilisable',
                                name: 'Nom du modèle',
                                namePlaceholder: 'Mon modèle personnalisé',
                                description: 'Description du modèle',
                                descriptionPlaceholder: 'Description de ce modèle'
                            },
                            create: 'Créer mon site',
                            creating: 'Création en cours...'
                        },
                        result: {
                            success: {
                                title: 'Site créé avec succès !',
                                message: 'Votre site web est maintenant prêt et déployé.',
                                details: 'Détails de la création',
                                siteId: 'ID du site',
                                template: 'Modèle sauvegardé',
                                status: 'Statut',
                                ready: 'Prêt',
                                view: 'Voir mon site',
                                dashboard: 'Tableau de bord'
                            },
                            error: {
                                title: 'Erreur lors de la création',
                                message: 'Une erreur s\'est produite lors de la création de votre site.',
                                details: 'Détails de l\'erreur',
                                retry: 'Réessayer',
                                restart: 'Recommencer'
                            }
                        }
                    }
                },

                // Computed properties
                get selectedBusinessType() {
                    return this.businessTypes[this.wizardData.businessType];
                },

                // Initialization
                init() {
                    // Ensure default template is selected
                    if (!this.wizardData.selectedTemplate) {
                        this.wizardData.selectedTemplate = 'custom';
                    }
                    
                    // Ensure activities array is properly initialized
                    if (!this.wizardData.services || !Array.isArray(this.wizardData.services)) {
                        this.wizardData.services = [{ name: '', description: '', id: 1 }];
                    }
                    
                    // Ensure availableTemplates is initialized
                    if (!this.availableTemplates) {
                        this.availableTemplates = [];
                    }
                    
                    this.loadTemplates();
                    this.generateContent();
                    this.updateLanguage();
                    this.loadSavedData(); // Load any saved progress
                    
                    // Auto-save functionality
                    this.$watch('wizardData', () => {
                        this.autoSave();
                    }, { deep: true });
                    
                    // Global click handler to close suggestions
                    document.addEventListener('click', (e) => {
                        if (!e.target.closest('.relative')) {
                            this.showBusinessTypeSuggestions = false;
                        }
                    });
                },

                // Language management
                updateLanguage() {
                    this.language = this.wizardData.language;
                    // Update step titles based on language - USER PERSPECTIVE NUMBERING
                    if (this.language === 'fr') {
                        this.steps.forEach((step, index) => {
                            const titles = [
                                'Step 1: Bienvenue',      // currentStep === 0
                                'Step 2: Modèle',         // currentStep === 1  
                                'Step 3: Informations',   // currentStep === 2
                                'Step 4: Contenu',        // currentStep === 3
                                'Step 5: Images',         // currentStep === 4
                                'Step 6: Fonctionnalités', // currentStep === 5
                                'Step 7: Révision & Création' // currentStep === 6
                            ];
                            step.title = titles[index];
                        });
                    }
                },

                // Template management
                async loadTemplates() {
                    try {
                        const response = await fetch('/api/templates');
                        const result = await response.json();
                        
                        // Handle API response format: {success: true, templates: [...]}
                        if (result.success && result.templates) {
                            this.availableTemplates = result.templates;
                        } else {
                            this.availableTemplates = [];
                        }
                        
                        // Auto-select Template Basic if it exists and no template is selected
                        if (this.availableTemplates.length > 0 && !this.wizardData.selectedTemplate) {
                            const basicTemplate = this.availableTemplates.find(t => t.name === 'template-base');
                            if (basicTemplate) {
                                await this.selectTemplate(basicTemplate.name);
                            }
                        }
                    } catch (error) {
                        console.error('Error loading templates:', error);
                        this.availableTemplates = [];
                    }
                },

                async selectTemplate(templateName) {
                    this.wizardData.selectedTemplate = templateName;
                    
                    if (templateName !== 'custom') {
                        try {
                            const response = await fetch(`/api/templates/${templateName}`);
                            this.selectedTemplateData = await response.json();
                            
                            // Apply template defaults
                            if (this.selectedTemplateData.brand?.colors) {
                                this.wizardData.colors = { ...this.selectedTemplateData.brand.colors };
                            }
                        } catch (error) {
                            console.error('Error loading template data:', error);
                        }
                    }
                },

                // Business type management (enhanced for Step 2)
                showBusinessTypeSuggestions: false,
                filteredBusinessTypes: [],
                errors: {
                    siteName: '',
                    businessType: '',
                    domain: ''
                },
                
                updateBusinessType() {
                    const businessType = this.selectedBusinessType;
                    if (businessType && businessType.colors) {
                        this.wizardData.colors = { ...businessType.colors };
                        this.wizardData.selectedColorPalette = 'custom';
                    }
                    this.generateContent();
                },
                
                handleBusinessTypeInput(event) {
                    const value = event.target.value.toLowerCase();
                    this.showBusinessTypeSuggestions = value.length > 0;
                    
                    // Filter business types based on input
                    this.filteredBusinessTypes = Object.entries(this.businessTypes)
                        .filter(([key, type]) => {
                            return type.name.toLowerCase().includes(value) || 
                                   type.description.toLowerCase().includes(value) ||
                                   key.toLowerCase().includes(value);
                        })
                        .map(([key, type]) => ({
                            key: key,
                            name: type.name,
                            description: type.description
                        }))
                        .slice(0, 5); // Limit to 5 suggestions
                        
                    // Clear business type error when typing
                    this.errors.businessType = '';
                },
                
                selectBusinessTypeSuggestion(key, name) {
                    this.wizardData.businessType = key;
                    this.showBusinessTypeSuggestions = false;
                    // Update terminology based on business type
                    const businessType = this.businessTypes[key];
                    if (businessType && businessType.terminology) {
                        this.wizardData.terminology = businessType.terminology;
                    }
                    this.updateBusinessType();
                },
                
                // Validation methods
                validateSiteName() {
                    if (!this.wizardData.siteName || this.wizardData.siteName.length < 3) {
                        this.errors.siteName = 'Le nom du site doit contenir au moins 3 caractères';
                        return false;
                    }
                    if (this.wizardData.siteName.length > 50) {
                        this.errors.siteName = 'Le nom du site ne peut pas dépasser 50 caractères';
                        return false;
                    }
                    this.errors.siteName = '';
                    return true;
                },
                
                validateDomain() {
                    if (!this.wizardData.domain) {
                        this.errors.domain = '';
                        return true; // Optional field
                    }
                    
                    const domainRegex = /^[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9]?\.[a-zA-Z]{2,}$/;
                    if (!domainRegex.test(this.wizardData.domain)) {
                        this.errors.domain = 'Format invalide (ex: mon-site.com)';
                        return false;
                    }
                    this.errors.domain = '';
                    return true;
                },
                
                canProceedFromStep2() {
                    return this.wizardData.siteName && 
                           this.wizardData.siteName.length >= 3 && 
                           this.wizardData.businessType && 
                           this.wizardData.businessType.length >= 3 &&
                           (!this.wizardData.domain || this.validateDomain());
                },
                
                generateSiteId(siteName) {
                    if (!siteName) return '';
                    return siteName
                        .toLowerCase()
                        .replace(/[^a-z0-9]+/g, '-')
                        .replace(/^-|-$/g, '')
                        .substring(0, 30);
                },
                
                // Step 4: Image Management Methods
                selectImageApproach(approach) {
                    this.wizardData.imageApproach = approach;
                    
                    // Initialize image choices structure
                    if (!this.wizardData.imageChoices) {
                        this.wizardData.imageChoices = {};
                    }
                    
                    // Reset image choices when switching approach
                    if (approach === 'manual') {
                        this.wizardData.imageChoices = {
                            logo: 'upload',
                            logoFooter: 'upload',
                            hero: 'upload', 
                            faviconLight: 'upload',
                            faviconDark: 'upload',
                            services: [],
                            blog: []
                        };
                        // Set all service images to upload
                        this.wizardData.services.forEach((_, index) => {
                            this.wizardData.imageChoices.services[index] = 'upload';
                        });
                        // Set all blog images to upload
                        (this.wizardData.blog?.articles || []).forEach((_, index) => {
                            this.wizardData.imageChoices.blog[index] = 'upload';
                        });
                    } else if (approach === 'ai') {
                        this.wizardData.imageChoices = {
                            logo: 'ai',
                            logoFooter: 'ai',
                            hero: 'ai',
                            faviconLight: 'ai',
                            faviconDark: 'ai',
                            services: [],
                            blog: []
                        };
                        // Set all service images to AI
                        this.wizardData.services.forEach((_, index) => {
                            this.wizardData.imageChoices.services[index] = 'ai';
                        });
                        // Set all blog images to AI
                        (this.wizardData.blog?.articles || []).forEach((_, index) => {
                            this.wizardData.imageChoices.blog[index] = 'ai';
                        });
                    } else if (approach === 'mixed') {
                        // Mixed: initialize with upload as default, user can switch individually
                        if (!this.wizardData.imageChoices.logo) {
                            this.wizardData.imageChoices = {
                                logo: 'upload',
                                logoFooter: 'upload',
                                hero: 'upload',
                                faviconLight: 'upload',
                                faviconDark: 'upload',
                                services: [],
                                blog: []
                            };
                            // Initialize service choices
                            this.wizardData.services.forEach((_, index) => {
                                this.wizardData.imageChoices.services[index] = 'upload';
                            });
                            // Initialize blog choices
                            (this.wizardData.blog?.articles || []).forEach((_, index) => {
                                this.wizardData.imageChoices.blog[index] = 'upload';
                            });
                        }
                    }
                },
                
                handleFileUpload(event, imageType) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // Validate file size (5MB max for logo/hero, 2MB for others)
                    const maxSize = (imageType === 'logo' || imageType === 'hero' || imageType === 'logoFooter') ? 5 * 1024 * 1024 : 2 * 1024 * 1024;
                    if (file.size > maxSize) {
                        alert(`Fichier trop volumineux. Max ${maxSize === 5 * 1024 * 1024 ? '5MB' : '2MB'}.`);
                        return;
                    }
                    
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert('Seuls les fichiers image sont acceptés.');
                        return;
                    }
                    
                    // Create preview
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // Initialize images object if needed
                        if (!this.wizardData.images) {
                            this.wizardData.images = {};
                        }
                        
                        // Handle service images
                        if (imageType.startsWith('service_')) {
                            const index = parseInt(imageType.split('_')[1]);
                            if (!this.wizardData.images.services) {
                                this.wizardData.images.services = [];
                            }
                            this.wizardData.images.services[index] = e.target.result;
                        }
                        // Handle blog images
                        else if (imageType.startsWith('blog_')) {
                            const index = parseInt(imageType.split('_')[1]);
                            if (!this.wizardData.images.blog) {
                                this.wizardData.images.blog = [];
                            }
                            this.wizardData.images.blog[index] = e.target.result;
                        }
                        // Handle regular images
                        else {
                            this.wizardData.images[imageType] = e.target.result;
                        }
                        
                        // Store file metadata for later upload
                        if (!this.wizardData.imageFiles) {
                            this.wizardData.imageFiles = {};
                        }
                        this.wizardData.imageFiles[imageType] = file;
                    };
                    reader.readAsDataURL(file);
                },
                
                handleFileDrop(event, imageType) {
                    event.preventDefault();
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        // Simulate file input change
                        const fakeEvent = {
                            target: { files: files }
                        };
                        this.handleFileUpload(fakeEvent, imageType);
                    }
                },
                
                removeImage(imageType) {
                    this.wizardData.images[imageType] = null;
                },
                
                removeServiceImage(index) {
                    if (this.wizardData.images.services) {
                        this.wizardData.images.services[index] = null;
                    }
                },
                
                triggerServiceUpload(index) {
                    console.log(`📁 Triggering service upload for index ${index}`);
                    const fileInput = document.getElementById(`serviceInput-${index}`);
                    if (fileInput) {
                        fileInput.click();
                    } else {
                        console.error(`❌ Could not find service input: serviceInput-${index}`);
                    }
                },
                
                triggerBlogUpload(index) {
                    console.log(`📁 Triggering blog upload for index ${index}`);
                    const fileInput = document.getElementById(`blogInput-${index}`);
                    if (fileInput) {
                        fileInput.click();
                    } else {
                        console.error(`❌ Could not find blog input: blogInput-${index}`);
                    }
                },
                
                removeBlogImage(index) {
                    if (this.wizardData.images.blog) {
                        this.wizardData.images.blog[index] = null;
                    }
                },
                
                setImageChoice(imageType, choice) {
                    // Handle service images
                    if (imageType.startsWith('service_')) {
                        const index = parseInt(imageType.split('_')[1]);
                        if (!this.wizardData.imageChoices.services) {
                            this.wizardData.imageChoices.services = [];
                        }
                        this.wizardData.imageChoices.services[index] = choice;
                        if (choice === 'ai' && this.wizardData.images.services) {
                            this.wizardData.images.services[index] = null;
                        }
                    }
                    // Handle blog images
                    else if (imageType.startsWith('blog_')) {
                        const index = parseInt(imageType.split('_')[1]);
                        if (!this.wizardData.imageChoices.blog) {
                            this.wizardData.imageChoices.blog = [];
                        }
                        this.wizardData.imageChoices.blog[index] = choice;
                        if (choice === 'ai' && this.wizardData.images.blog) {
                            this.wizardData.images.blog[index] = null;
                        }
                    }
                    // Handle regular images
                    else {
                        this.wizardData.imageChoices[imageType] = choice;
                        // Clear uploaded image if switching to AI
                        if (choice === 'ai') {
                            this.wizardData.images[imageType] = null;
                        }
                    }
                },

                setOtherImagesChoice(choice) {
                    this.wizardData.otherImagesChoice = choice;
                    // Set choice for logoFooter, faviconLight, faviconDark, and clear uploads if switching to AI
                    ['logoFooter', 'faviconLight', 'faviconDark'].forEach(imageType => {
                        this.setImageChoice(imageType, choice);
                    });
                },

                hasAIChoices() {
                    if (this.wizardData.imageApproach !== 'mixed') return false;
                    
                    // Check if any image is marked for AI generation
                    const allChoices = Object.values(this.wizardData.imageChoices || {});
                    return allChoices.includes('ai') || this.wizardData.otherImagesChoice === 'ai';
                },
                
                // Coûts supprimés - génération via queue admin
                
                canProceedFromStep3() {
                    // Must select an approach
                    if (!this.wizardData.imageApproach) return false;
                    
                    // For manual approach, logo is required
                    if (this.wizardData.imageApproach === 'manual') {
                        return this.wizardData.images.logo !== null;
                    }
                    
                    // For AI approach, always valid (will generate)
                    if (this.wizardData.imageApproach === 'ai') {
                        return true;
                    }
                    
                    // For mixed approach, must have all required images (upload OR ai)
                    if (this.wizardData.imageApproach === 'mixed') {
                        const requiredChoices = ['logo', 'logoFooter', 'hero', 'faviconLight', 'faviconDark'];
                        return requiredChoices.every(imageType => {
                            return this.wizardData.imageChoices[imageType] === 'ai' || 
                                   this.wizardData.images[imageType] !== null;
                        });
                    }
                    
                    return false;
                },

                canProceedFromCurrentStep() {
                    switch (this.currentStep) {
                        case 0:
                            return this.wizardData.termsAccepted;
                        case 1:
                            return this.wizardData.selectedTemplate;
                        case 2:
                            return this.canProceedFromStep2();
                        case 3:
                            return this.wizardData.contact?.email && 
                                   !this.wizardData.services.some(s => !s.name);
                        case 4:
                            return this.canProceedFromStep3();
                        case 5:
                            return true; // Review step
                        case 6:
                            return true; // Advanced features step
                        case 7:
                            return true; // Final review step
                        default:
                            return true;
                    }
                },

                // Logo management
                handleLogoUpload(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.processLogoFile(file);
                    }
                },

                handleLogoDrop(event) {
                    event.preventDefault();
                    const file = event.dataTransfer.files[0];
                    if (file && file.type.startsWith('image/')) {
                        this.processLogoFile(file);
                    }
                },

                processLogoFile(file) {
                    if (file.size > 2 * 1024 * 1024) { // 2MB limit
                        alert('Le fichier est trop volumineux. Maximum 2MB.');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.wizardData.logo = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },

                removeLogo() {
                    this.wizardData.logo = null;
                },

                // Color management
                selectColorPalette(paletteName) {
                    this.wizardData.selectedColorPalette = paletteName;
                    this.wizardData.colors = { ...this.colorPalettes[paletteName] };
                },

                updateCustomColors() {
                    this.wizardData.selectedColorPalette = 'custom';
                },

                // Activity management
                addService() {
                    const newId = Date.now() + Math.random(); // Unique ID
                    this.wizardData.services.push({ name: '', description: '', id: newId });
                },

                removeService(index) {
                    if (this.wizardData.services.length > 1) {
                        this.wizardData.services.splice(index, 1);
                    }
                },

                // Blog article management
                addBlogArticle() {
                    if (!this.wizardData.blog) {
                        this.wizardData.blog = { articles: [] };
                    }
                    if (!this.wizardData.blog.articles) {
                        this.wizardData.blog.articles = [];
                    }
                    this.wizardData.blog.articles.push({
                        title: '',
                        excerpt: '',
                        content: '',
                        category: '',
                        tags: [],
                        image: null
                    });
                },

                removeBlogArticle(index) {
                    if (this.wizardData.blog?.articles?.length > 1) {
                        this.wizardData.blog.articles.splice(index, 1);
                    }
                },

                // Testimonial management
                addTestimonial() {
                    if (!this.wizardData.testimonials) {
                        this.wizardData.testimonials = [];
                    }
                    this.wizardData.testimonials.push({
                        text: '',
                        name: '',
                        position: '',
                        rating: 5
                    });
                },

                removeTestimonial(index) {
                    if (this.wizardData.testimonials && this.wizardData.testimonials.length > 0) {
                        this.wizardData.testimonials.splice(index, 1);
                    }
                },

                // FAQ management
                addFAQ() {
                    if (!this.wizardData.faq) {
                        this.wizardData.faq = [];
                    }
                    this.wizardData.faq.push({
                        question: '',
                        answer: ''
                    });
                },

                removeFAQ(index) {
                    if (this.wizardData.faq && this.wizardData.faq.length > 0) {
                        this.wizardData.faq.splice(index, 1);
                    }
                },
                
                handleBlogImageUpload(event, index) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    // Validate file type
                    if (!file.type.startsWith('image/')) {
                        alert('Veuillez sélectionner un fichier image valide');
                        return;
                    }
                    
                    // Validate file size (max 5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        alert('La taille du fichier ne doit pas dépasser 5MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        // Ensure images.blog array exists
                        if (!this.wizardData.images) {
                            this.wizardData.images = {};
                        }
                        if (!this.wizardData.images.blog) {
                            this.wizardData.images.blog = [];
                        }
                        
                        // Set the image in the images.blog array to match Step 5 structure
                        this.wizardData.images.blog[index] = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },

                // New functions for revision section
                handleServiceImageUpload(event, index) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    if (!file.type.startsWith('image/')) {
                        alert('Veuillez sélectionner un fichier image valide');
                        return;
                    }
                    
                    if (file.size > 5 * 1024 * 1024) {
                        alert('La taille du fichier ne doit pas dépasser 5MB');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        if (!this.wizardData.images) {
                            this.wizardData.images = {};
                        }
                        if (!this.wizardData.images.services) {
                            this.wizardData.images.services = [];
                        }
                        this.wizardData.images.services[index] = e.target.result;
                    };
                    reader.readAsDataURL(file);
                },

                addTestimonial() {
                    if (!this.wizardData.testimonials) {
                        this.wizardData.testimonials = [];
                    }
                    this.wizardData.testimonials.push({
                        text: '',
                        name: '',
                        position: '',
                        rating: 5
                    });
                },

                removeTestimonial(index) {
                    if (this.wizardData.testimonials && this.wizardData.testimonials.length > index) {
                        this.wizardData.testimonials.splice(index, 1);
                    }
                },

                addFAQ() {
                    if (!this.wizardData.faq) {
                        this.wizardData.faq = [];
                    }
                    this.wizardData.faq.push({
                        question: '',
                        answer: ''
                    });
                },

                removeFAQ(index) {
                    if (this.wizardData.faq && this.wizardData.faq.length > index) {
                        this.wizardData.faq.splice(index, 1);
                    }
                },

                // AI Integration Functions
                async generateCompleteContent() {
                    try {
                        // Generate ALL content types in one request
                        const requestData = {
                            customer_id: this.generateCustomerId(),
                            site_id: this.generateSiteId(),
                            request_type: 'content', // Always generate complete content
                            business_type: this.wizardData.businessType,
                            terminology: this.wizardData.terminology || 'services',
                            request_data: {
                                siteName: this.wizardData.siteName,
                                businessType: this.wizardData.businessType,
                                domain: this.wizardData.domain,
                                slogan: this.wizardData.slogan,
                                businessDescription: this.wizardData.businessDescription,
                                colors: this.wizardData.colors,
                                existingServices: this.wizardData.services
                            },
                            wizard_session_id: this.sessionId,
                            estimated_cost: this.aiRequest.estimatedCost
                        };

                        const response = await fetch('/admin/queue/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            this.aiRequest.id = result.request_id;
                            this.aiRequest.status = 'pending';
                            this.aiRequest.startTime = Date.now();
                            this.aiRequest.elapsedTime = '00:00';
                            
                            // Start polling for status updates
                            this.startPollingAIStatus();
                            // Start timer
                            this.startElapsedTimer();
                            
                            // Show success message
                            this.showNotification('Demande IA créée ! Un expert va traiter votre demande.', 'success');
                        } else {
                            throw new Error('Failed to create AI request');
                        }
                    } catch (error) {
                        console.error('AI request error:', error);
                        this.showNotification('Erreur lors de la création de la demande IA. Veuillez réessayer.', 'error');
                    }
                },

                async requestImageGeneration() {
                    try {
                        // Determine which images need AI generation
                        const imagesNeeded = {};
                        
                        if (this.wizardData.imageApproach === 'ai') {
                            // AI approach: generate all images
                            imagesNeeded.logo = true;
                            imagesNeeded.logoFooter = true;
                            imagesNeeded.hero = true;
                            imagesNeeded.faviconLight = true;
                            imagesNeeded.faviconDark = true;
                            imagesNeeded.services = this.wizardData.services.map(s => s.name || `Service ${this.wizardData.services.indexOf(s) + 1}`);
                            imagesNeeded.blog = (this.wizardData.blog?.articles || []).map(a => a.title || `Article ${(this.wizardData.blog?.articles || []).indexOf(a) + 1}`);
                        } else if (this.wizardData.imageApproach === 'mixed') {
                            // Mixed approach: only generate images marked as 'ai'
                            const choices = this.wizardData.imageChoices || {};
                            
                            // Check main images
                            if (choices.logo === 'ai') imagesNeeded.logo = true;
                            if (choices.logoFooter === 'ai') imagesNeeded.logoFooter = true;
                            if (choices.hero === 'ai') imagesNeeded.hero = true;
                            if (choices.faviconLight === 'ai') imagesNeeded.faviconLight = true;
                            if (choices.faviconDark === 'ai') imagesNeeded.faviconDark = true;
                            
                            // Check service images
                            const servicesForAI = [];
                            this.wizardData.services.forEach((service, index) => {
                                if (!choices.services || choices.services[index] === 'ai') {
                                    servicesForAI.push(service.name || `Service ${index + 1}`);
                                }
                            });
                            if (servicesForAI.length > 0) imagesNeeded.services = servicesForAI;
                            
                            // Check blog images
                            const blogForAI = [];
                            (this.wizardData.blog?.articles || []).forEach((article, index) => {
                                if (!choices.blog || choices.blog[index] === 'ai') {
                                    blogForAI.push(article.title || `Article ${index + 1}`);
                                }
                            });
                            if (blogForAI.length > 0) imagesNeeded.blog = blogForAI;
                        }

                        const requestData = {
                            customer_id: this.generateCustomerId(),
                            site_id: this.generateSiteId(this.wizardData.siteName),
                            request_type: 'images',
                            business_type: this.wizardData.businessType,
                            style: this.wizardData.aiStyle || 'modern',
                            request_data: {
                                siteName: this.wizardData.siteName,
                                businessType: this.wizardData.businessType,
                                slogan: this.wizardData.slogan,
                                businessDescription: this.wizardData.businessDescription,
                                colors: this.wizardData.colors,
                                imagesNeeded: imagesNeeded,
                                terminology: this.wizardData.terminology,
                                approach: this.wizardData.imageApproach
                            },
                            wizard_session_id: this.sessionId,
                            estimated_cost: 0
                        };

                        const response = await fetch('/admin/queue/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            this.imageAiRequest.id = result.request_id;
                            this.imageAiRequest.status = 'pending';
                            
                            // Start polling for status updates
                            this.startPollingImageStatus();
                            
                            // Show success message
                            this.showNotification('Demande de génération d\'images créée ! Un expert va générer vos images.', 'success');
                        } else {
                            throw new Error('Failed to create image generation request');
                        }
                    } catch (error) {
                        console.error('Image generation request error:', error);
                        this.showNotification('Erreur lors de la création de la demande. Veuillez réessayer.', 'error');
                    }
                },

                // Images générées via queue admin - pas de coût calculé

                startPollingImageStatus() {
                    if (this.imageAiRequest.pollInterval) {
                        clearInterval(this.imageAiRequest.pollInterval);
                    }

                    this.imageAiRequest.pollInterval = setInterval(async () => {
                        try {
                            const response = await fetch(`/admin/status/${this.imageAiRequest.id}`);
                            if (response.ok) {
                                const result = await response.json();
                                this.imageAiRequest.status = result.status;
                                
                                if (result.status === 'completed') {
                                    // Get full request details to get generated images
                                    const detailResponse = await fetch(`/admin/request/${this.imageAiRequest.id}`);
                                    if (detailResponse.ok) {
                                        const detailResult = await detailResponse.json();
                                        this.imageAiRequest.generatedImages = detailResult.generated_content;
                                        
                                        // Apply generated images
                                        this.applyGeneratedImages();
                                    }
                                    
                                    clearInterval(this.imageAiRequest.pollInterval);
                                    this.showNotification('Images générées avec succès !', 'success');
                                } else if (result.status === 'rejected') {
                                    this.showNotification('Demande d\'images rejetée. Veuillez contacter le support.', 'error');
                                    clearInterval(this.imageAiRequest.pollInterval);
                                }
                            }
                        } catch (error) {
                            console.error('Image status polling error:', error);
                        }
                    }, 5000); // Poll every 5 seconds
                },

                applyGeneratedImages() {
                    if (!this.imageAiRequest.generatedImages) return;
                    
                    try {
                        const images = JSON.parse(this.imageAiRequest.generatedImages);
                        
                        // Initialize images object if not exists
                        if (!this.wizardData.images) {
                            this.wizardData.images = {};
                        }
                        
                        // Apply base images (admin uploaded images come as filenames)
                        if (images.logo) {
                            this.wizardData.images.logo = images.logo.startsWith('data:') ? images.logo : `/configs/${this.generateSiteId()}/assets/${images.logo}`;
                        }
                        if (images.logoFooter) {
                            this.wizardData.images.logoFooter = images.logoFooter.startsWith('data:') ? images.logoFooter : `/configs/${this.generateSiteId()}/assets/${images.logoFooter}`;
                        }
                        if (images.hero) {
                            this.wizardData.images.hero = images.hero.startsWith('data:') ? images.hero : `/configs/${this.generateSiteId()}/assets/${images.hero}`;
                        }
                        if (images.faviconLight) {
                            this.wizardData.images.faviconLight = images.faviconLight.startsWith('data:') ? images.faviconLight : `/configs/${this.generateSiteId()}/assets/${images.faviconLight}`;
                        }
                        if (images.faviconDark) {
                            this.wizardData.images.faviconDark = images.faviconDark.startsWith('data:') ? images.faviconDark : `/configs/${this.generateSiteId()}/assets/${images.faviconDark}`;
                        }
                        
                        // Apply service images
                        if (images.services) {
                            if (!this.wizardData.images.services) {
                                this.wizardData.images.services = [];
                            }
                            Object.keys(images.services).forEach(key => {
                                if (key.startsWith('service_')) {
                                    const index = parseInt(key.split('_')[1]);
                                    const filename = images.services[key];
                                    this.wizardData.images.services[index] = filename.startsWith('data:') ? filename : `/configs/${this.generateSiteId()}/assets/${filename}`;
                                }
                            });
                        }
                        
                        // Apply blog images
                        if (images.blog) {
                            if (!this.wizardData.images.blog) {
                                this.wizardData.images.blog = [];
                            }
                            Object.keys(images.blog).forEach(key => {
                                if (key.startsWith('blog_')) {
                                    const index = parseInt(key.split('_')[1]);
                                    const filename = images.blog[key];
                                    this.wizardData.images.blog[index] = filename.startsWith('data:') ? filename : `/configs/${this.generateSiteId()}/assets/${filename}`;
                                }
                            });
                        }
                        
                        console.log('✅ Images appliquées avec succès dans le wizard');
                        this.showNotification('Images intégrées dans le wizard !', 'success');
                    } catch (error) {
                        console.error('Error applying generated images:', error);
                    }
                },

                startPollingAIStatus() {
                    if (this.aiRequest.pollInterval) {
                        clearInterval(this.aiRequest.pollInterval);
                    }

                    this.aiRequest.pollInterval = setInterval(async () => {
                        try {
                            const response = await fetch(`/admin/status/${this.aiRequest.id}`);
                            if (response.ok) {
                                const result = await response.json();
                                this.aiRequest.status = result.status;
                                
                                if (result.status === 'completed') {
                                    // Get full request details to get generated content
                                    const detailResponse = await fetch(`/admin/request/${this.aiRequest.id}`);
                                    if (detailResponse.ok) {
                                        const detailResult = await detailResponse.json();
                                        this.aiRequest.generatedContent = detailResult.generated_content;
                                        
                                        console.log('🎯 AI content received, length:', detailResult.generated_content?.length);
                                        console.log('🎯 Generated content preview:', detailResult.generated_content?.substring(0, 200));
                                        
                                        // Auto-apply generated content immediately with robust error handling
                                        try {
                                            this.applyGeneratedContent();
                                            console.log('✅ applyGeneratedContent() called successfully');
                                            
                                            // Force Alpine.js reactivity update
                                            this.$nextTick(() => {
                                                // Trigger Vue/Alpine reactivity by reassigning
                                                this.wizardData = { ...this.wizardData };
                                                console.log('🔄 Forced reactivity update');
                                            });
                                            
                                            // Verify content was applied
                                            const activitiesAfter = this.wizardData.services?.length || 0;
                                            const heroAfter = this.wizardData.hero?.title || 'NONE';
                                            console.log('📊 After apply - Activities:', activitiesAfter, 'Hero:', heroAfter);
                                            
                                        } catch (applyError) {
                                            console.error('❌ applyGeneratedContent() failed:', applyError);
                                            this.showNotification('Erreur lors de l\'application du contenu. Détails dans la console.', 'error');
                                            return;
                                        }
                                        
                                        // Show step-specific notification
                                        const currentStepName = this.currentStep === 3 ? 'Step 4: Contenu' : 
                                                              this.currentStep === 4 ? 'Step 5: Images' : 
                                                              `Step ${this.currentStep + 1}`;
                                        
                                        this.showNotification(`✅ Contenu IA appliqué dans ${currentStepName} ! Vérifiez les champs de formulaire mis à jour.`, 'success');
                                    }
                                    
                                    clearInterval(this.aiRequest.pollInterval);
                                    this.stopElapsedTimer();
                                } else if (result.status === 'rejected') {
                                    this.showNotification('Demande IA rejetée. Veuillez contacter le support.', 'error');
                                    clearInterval(this.aiRequest.pollInterval);
                                    this.stopElapsedTimer();
                                }
                            }
                        } catch (error) {
                            console.error('Status polling error:', error);
                        }
                    }, 5000); // Poll every 5 seconds
                },

                startElapsedTimer() {
                    if (this.aiRequest.timerInterval) {
                        clearInterval(this.aiRequest.timerInterval);
                    }

                    this.aiRequest.timerInterval = setInterval(() => {
                        if (this.aiRequest.startTime) {
                            const elapsed = Math.floor((Date.now() - this.aiRequest.startTime) / 1000);
                            const minutes = Math.floor(elapsed / 60);
                            const seconds = elapsed % 60;
                            this.aiRequest.elapsedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        }
                    }, 1000);
                },

                stopElapsedTimer() {
                    if (this.aiRequest.timerInterval) {
                        clearInterval(this.aiRequest.timerInterval);
                        this.aiRequest.timerInterval = null;
                    }
                },

                applyGeneratedContent() {
                    console.log('🔧 applyGeneratedContent() called');
                    console.log('🔧 generatedContent exists:', !!this.aiRequest.generatedContent);
                    
                    if (this.aiRequest.generatedContent) {
                        try {
                            console.log('🔧 Parsing JSON content...');
                            let content = JSON.parse(this.aiRequest.generatedContent);
                            
                            // Handle double-encoded JSON (string within string)
                            if (typeof content === 'string') {
                                console.log('🔧 Double-encoded JSON detected, parsing again...');
                                content = JSON.parse(content);
                            }
                            
                            console.log('✅ JSON parsed successfully:', Object.keys(content));
                        
                        // Apply all generated content
                        if (content.services) {
                            console.log('🔧 Applying services:', content.services.length, 'services');
                            const beforeCount = this.wizardData.services?.length || 0;
                            
                            // Replace current activities with AI generated services
                            // Clear existing activities first to ensure Alpine.js detects changes
                            this.wizardData.services = [];
                            
                            // Add new services one by one to trigger reactivity
                            const newServices = content.services.map((service, index) => ({
                                id: Date.now() + index,
                                name: service.name || service.title,
                                description: service.description,
                                features: service.features || [],
                                price: service.price || '',
                                category: service.category || ''
                            }));
                            
                            // Force reactivity by pushing each item
                            newServices.forEach(service => {
                                this.wizardData.services.push(service);
                            });
                            
                            const afterCount = this.wizardData.services?.length || 0;
                            console.log('✅ Services applied:', beforeCount, '=>', afterCount);
                        }
                        
                        // Apply hero content
                        if (content.hero) {
                            console.log('🔧 Applying hero content');
                            const beforeHero = this.wizardData.hero?.title || 'NONE';
                            
                            // Ensure hero object exists
                            if (!this.wizardData.hero) {
                                this.wizardData.hero = {};
                            }
                            
                            // Apply each property individually to trigger reactivity
                            this.wizardData.hero.title = content.hero.title || this.wizardData.siteName;
                            this.wizardData.hero.subtitle = content.hero.subtitle || '';
                            this.wizardData.hero.description = content.hero.description || '';
                            
                            const afterHero = this.wizardData.hero?.title || 'NONE';
                            console.log('✅ Hero applied:', beforeHero, '=>', afterHero);
                        }
                        
                        // Apply about content
                        if (content.about) {
                            this.wizardData.about = {
                                title: content.about.title || `À propos de ${this.wizardData.siteName}`,
                                subtitle: content.about.subtitle || '',
                                description: content.about.description || '',
                                values: content.about.values || []
                            };
                        }
                        
                        // Apply testimonials
                        if (content.testimonials) {
                            this.wizardData.testimonials = content.testimonials;
                        }
                        
                        // Apply FAQ
                        if (content.faq) {
                            this.wizardData.faq = content.faq;
                        }
                        
                        // Apply services page content
                        if (content.servicesPage) {
                            this.wizardData.servicesPage = content.servicesPage;
                        }
                        
                        // Apply SEO content
                        if (content.seo) {
                            this.wizardData.seo = content.seo;
                        }
                        
                        // Apply terminology
                        if (content.terminology) {
                            this.wizardData.terminology = content.terminology;
                        }
                        
                        // Apply blog articles
                        if (content.blog && content.blog.articles) {
                            this.wizardData.blog.articles = content.blog.articles;
                        }
                        
                        this.showNotification('Contenu complet appliqué avec succès !', 'success');
                        
                        // Force complete Alpine.js update with aggressive DOM manipulation
                        console.log('🔄 Forcing complete Alpine.js reactivity update...');
                        
                        // Method 1: Trigger Alpine.js reactivity with manual proxy update
                        const originalServices = this.wizardData.services;
                        this.wizardData.services = [];
                        
                        // Force Alpine.js to re-process the template
                        this.$nextTick(() => {
                            // Now set the new services
                            this.wizardData.services = originalServices;
                            
                            console.log('🔄 Services reset and restored');
                            console.log('📊 Final services count:', this.wizardData.services.length);
                            console.log('📊 First service:', this.wizardData.services[0]);
                            
                            // Additional DOM manipulation after Alpine.js processes
                            this.$nextTick(() => {
                                console.log('🔄 Second tick - forcing input values...');
                                
                                // More robust input value setting with multiple selectors
                                const serviceNameInputs = document.querySelectorAll('input[x-model="service.name"]');
                                const serviceDescInputs = document.querySelectorAll('textarea[x-model="service.description"]');
                                
                                console.log('📊 Found service name inputs:', serviceNameInputs.length);
                                console.log('📊 Found service description inputs:', serviceDescInputs.length);
                                
                                // Force input values for service names
                                serviceNameInputs.forEach((input, index) => {
                                    const service = this.wizardData.services[index];
                                    if (service && service.name) {
                                        console.log(`🔧 Setting service name ${index}: "${service.name}"`);
                                        input.value = service.name;
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                        input.dispatchEvent(new Event('change', { bubbles: true }));
                                    }
                                });
                                
                                // Force input values for service descriptions
                                serviceDescInputs.forEach((input, index) => {
                                    const service = this.wizardData.services[index];
                                    if (service && service.description) {
                                        console.log(`🔧 Setting service desc ${index}: "${service.description.substring(0, 50)}..."`);
                                        input.value = service.description;
                                        input.dispatchEvent(new Event('input', { bubbles: true }));
                                        input.dispatchEvent(new Event('change', { bubbles: true }));
                                    }
                                });
                                
                                // Also force hero content updates
                                const heroTitleInput = document.querySelector('input[x-model="wizardData.hero.title"]');
                                const heroSubtitleInput = document.querySelector('input[x-model="wizardData.hero.subtitle"]');
                                const heroDescInput = document.querySelector('textarea[x-model="wizardData.hero.description"]');
                                
                                if (heroTitleInput && this.wizardData.hero?.title) {
                                    console.log('🔧 Setting hero title:', this.wizardData.hero.title);
                                    heroTitleInput.value = this.wizardData.hero.title;
                                    heroTitleInput.dispatchEvent(new Event('input', { bubbles: true }));
                                }
                                
                                if (heroSubtitleInput && this.wizardData.hero?.subtitle) {
                                    console.log('🔧 Setting hero subtitle:', this.wizardData.hero.subtitle);
                                    heroSubtitleInput.value = this.wizardData.hero.subtitle;
                                    heroSubtitleInput.dispatchEvent(new Event('input', { bubbles: true }));
                                }
                                
                                if (heroDescInput && this.wizardData.hero?.description) {
                                    console.log('🔧 Setting hero description:', this.wizardData.hero.description.substring(0, 50) + '...');
                                    heroDescInput.value = this.wizardData.hero.description;
                                    heroDescInput.dispatchEvent(new Event('input', { bubbles: true }));
                                }
                                
                                // Final Alpine.js force refresh
                                setTimeout(() => {
                                    console.log('🔄 Final refresh - triggering Alpine reactivity');
                                    
                                    // Force Alpine to re-evaluate all x-models
                                    const allInputs = document.querySelectorAll('[x-model]');
                                    allInputs.forEach(input => {
                                        const event = new Event('alpine:updated', { bubbles: true });
                                        input.dispatchEvent(event);
                                    });
                                    
                                    console.log('✅ All input value setting and Alpine refresh completed');
                                }, 500); // Small delay to ensure DOM is ready
                            });
                        });
                        
                        // Don't clear AI request - keep status and generatedContent for review section
                        // Only clear the ID to prevent re-processing
                        this.aiRequest.id = null;
                        
                        } catch (error) {
                            console.error('Error parsing generated content:', error);
                            this.showNotification('Erreur lors de l\'application du contenu généré. Veuillez contacter le support.', 'error');
                        }
                    }
                },

                getAIStatusClass() {
                    const classes = {
                        'pending': 'bg-yellow-50 border-yellow-200',
                        'assigned': 'bg-blue-50 border-blue-200',
                        'processing': 'bg-purple-50 border-purple-200',
                        'completed': 'bg-green-50 border-green-200',
                        'rejected': 'bg-red-50 border-red-200'
                    };
                    return classes[this.aiRequest.status] || 'bg-gray-50 border-gray-200';
                },

                getAIStatusMessage() {
                    const messages = {
                        'pending': 'Demande en attente de traitement...',
                        'assigned': 'Demande assignée à un expert...',
                        'processing': 'Génération de contenu en cours...',
                        'completed': 'Contenu généré avec succès !',
                        'rejected': 'Demande rejetée - contactez le support'
                    };
                    return messages[this.aiRequest.status] || 'Statut inconnu';
                },

                generateCustomerId() {
                    return 'wizard-customer-' + (this.sessionId || Date.now());
                },

                generateSiteId() {
                    const sanitized = (this.wizardData.siteName || 'site').toLowerCase()
                        .replace(/[^a-z0-9]/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '');
                    return sanitized + '-' + Date.now();
                },

                // Content generation
                generateContent() {
                    const businessType = this.selectedBusinessType;
                    const siteName = this.wizardData.siteName || 'Votre Entreprise';
                    const slogan = this.wizardData.slogan || businessType?.description || 'Services professionnels';
                    
                    this.generatedContent.hero = {
                        title: slogan,
                        subtitle: businessType?.description || 'Services professionnels de qualité',
                        description: `${siteName} offre des ${businessType?.terminology || 'services'} professionnels adaptés à vos besoins spécifiques.`
                    };
                },

                regenerateContent() {
                    this.generateContent();
                },

                // Navigation
                nextStep() {
                    if (this.currentStep < this.steps.length - 1) {
                        this.steps[this.currentStep].completed = true;
                        this.currentStep++;
                        this.wizardData.currentStep = this.currentStep; // Keep wizardData in sync
                        
                        // Generate content when moving to review step
                        if (this.currentStep === 5) {
                            this.generateContent();
                        }
                    }
                },

                prevStep() {
                    if (this.currentStep > 0) {
                        this.currentStep--;
                        this.wizardData.currentStep = this.currentStep; // Keep wizardData in sync
                    }
                },

                // Admin task creation functions
                async createGoogleAccountTask() {
                    try {
                        const response = await fetch('/admin/queue', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                request_type: 'google_account',
                                request_data: {
                                    siteId: this.wizardData.siteName,
                                    customerId: 'b131e26a1d916c086088491ea6ed0cfa',
                                    purpose: 'reCAPTCHA v2 setup',
                                    domain: this.wizardData.domain
                                },
                                status: 'pending',
                                priority: 'high'
                            })
                        });
                        
                        if (response.ok) {
                            alert('✅ Demande créée! Un admin va créer votre compte Google et configurer reCAPTCHA.');
                            this.wizardData.integrations.security.captcha.taskCreated = true;
                        } else {
                            alert('❌ Erreur lors de la création de la demande. Veuillez réessayer.');
                        }
                    } catch (error) {
                        console.error('Error creating Google account task:', error);
                        alert('❌ Erreur de connexion. Veuillez réessayer.');
                    }
                },

                async requestAdminHelp(type) {
                    const helpTypes = {
                        captcha: {
                            title: 'Aide configuration reCAPTCHA',
                            description: 'Besoin d\'aide pour configurer les clés reCAPTCHA'
                        },
                        analytics: {
                            title: 'Aide Google Analytics',
                            description: 'Besoin d\'aide pour configurer Google Analytics'
                        },
                        maps: {
                            title: 'Aide Google Maps',
                            description: 'Besoin d\'aide pour obtenir une clé API Maps'
                        },
                        calendly: {
                            title: 'Aide configuration Calendly',
                            description: 'Besoin d\'aide pour configurer Calendly pour la prise de RDV'
                        }
                    };

                    try {
                        const helpInfo = helpTypes[type] || { title: 'Aide demandée', description: 'Assistance requise' };
                        
                        const response = await fetch('/admin/queue', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                request_type: 'help_request',
                                request_data: {
                                    siteId: this.wizardData.siteName,
                                    customerId: 'b131e26a1d916c086088491ea6ed0cfa',
                                    helpType: type,
                                    title: helpInfo.title,
                                    description: helpInfo.description,
                                    currentStep: this.currentStep
                                },
                                status: 'pending',
                                priority: 'medium'
                            })
                        });
                        
                        if (response.ok) {
                            alert(`✅ ${helpInfo.title} - Un admin va vous contacter bientôt!`);
                        } else {
                            alert('❌ Erreur lors de la demande d\'aide. Veuillez réessayer.');
                        }
                    } catch (error) {
                        console.error('Error requesting admin help:', error);
                        alert('❌ Erreur de connexion. Veuillez réessayer.');
                    }
                },

                // Site creation
                async createSite(isDraft = false) {
                    console.log('Creating site...');
                    this.isCreating = true;
                    
                    try {
                        // Function to create image metadata instead of sending full base64
                        const processImages = (images) => {
                            if (!images) return {};
                            const metadata = {};
                            for (const [key, value] of Object.entries(images)) {
                                if (typeof value === 'string' && value.startsWith('data:')) {
                                    // For base64 images, just send metadata
                                    const sizeInBytes = Math.round((value.length * 3) / 4);
                                    metadata[key] = {
                                        type: 'base64',
                                        size: sizeInBytes,
                                        present: true
                                    };
                                } else if (Array.isArray(value)) {
                                    // For arrays (like blog images)
                                    metadata[key] = value.map(img => {
                                        if (typeof img === 'string' && img.startsWith('data:')) {
                                            return {
                                                type: 'base64',
                                                size: Math.round((img.length * 3) / 4),
                                                present: true
                                            };
                                        }
                                        return img;
                                    });
                                } else {
                                    metadata[key] = value;
                                }
                            }
                            return metadata;
                        };

                        // Prepare site data with enhanced structure
                        const siteData = {
                            name: this.wizardData.siteName,
                            businessType: this.wizardData.businessType,
                            domain: this.wizardData.domain,
                            slogan: this.wizardData.slogan,
                            colors: this.wizardData.colors,
                            services: this.wizardData.services.map(service => ({
                                title: service.name || service.title,
                                description: service.description
                            })),
                            activities: this.wizardData.services, // Keep original for terminology support
                            terminology: this.wizardData.terminology || 'services',
                            contact: this.wizardData.contact,
                            features: this.wizardData.features,
                            seo: this.wizardData.seo,
                            template: this.wizardData.selectedTemplate !== 'custom' ? this.wizardData.selectedTemplate : null,
                            generatedContent: this.generatedContent,
                            about: this.wizardData.about,
                            hero: this.wizardData.hero,
                            testimonials: this.wizardData.testimonials,
                            faq: this.wizardData.faq,
                            blog: this.wizardData.blog,
                            integrations: this.wizardData.integrations,
                            // Send both metadata and actual images
                            imageMetadata: processImages(this.wizardData.images),
                            images: this.wizardData.images, // Send actual images for saving
                            logo: this.wizardData.logo
                        };

                        // Check deploy option
                        const shouldDeploy = this.wizardData.deployOption === 'deploy';
                        console.log('Deploy option:', this.wizardData.deployOption, 'Should deploy:', shouldDeploy);
                        
                        // Create site
                        const response = await fetch('/api/sites/create', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                customerId: 'b131e26a1d916c086088491ea6ed0cfa', // wizard-user customer ID
                                siteData: siteData,
                                saveAsTemplate: this.wizardData.saveAsTemplate,
                                templateName: this.wizardData.templateName,
                                templateDescription: this.wizardData.templateDescription,
                                deploy: shouldDeploy
                            })
                        });

                        // Check if response is ok first
                        if (!response.ok) {
                            // Try to parse error as JSON, fall back to text if it fails
                            let errorMessage = `Erreur HTTP ${response.status}`;
                            try {
                                const errorData = await response.json();
                                errorMessage = errorData.details || errorData.error || errorMessage;
                            } catch (e) {
                                // Response is not JSON (probably HTML error page)
                                try {
                                    const text = await response.text();
                                    console.error('Non-JSON response:', text);
                                    errorMessage = `Erreur serveur (${response.status}): Impossible de créer le site`;
                                } catch (textError) {
                                    console.error('Could not read response:', textError);
                                }
                            }
                            throw new Error(errorMessage);
                        }

                        const result = await response.json();
                        console.log('Response:', response.ok, result);

                        if (result.error) {
                            throw new Error(result.details || result.error || 'Erreur de création');
                        }

                        this.creationResult = {
                            success: true,
                            siteId: result.site?.id || result.siteId || this.wizardData.siteName.toLowerCase().replace(/[^a-z0-9]+/g, '-'),
                            template: this.wizardData.saveAsTemplate ? this.wizardData.templateName : '',
                            error: '',
                            deployed: result.deployment ? true : false,
                            siteUrl: result.site?.url || result.deployment?.url || null,
                            port: result.site?.port || result.deployment?.port || null
                        };
                        
                        // Move to result display (Step 8 view)
                        this.currentStep = 7;
                    } catch (error) {
                        console.error('Site creation error:', error);
                        this.creationResult = {
                            success: false,
                            siteId: '',
                            template: '',
                            error: error.message
                        };
                        
                        // Move to result display even on error
                        this.currentStep = 7;
                    }

                    this.isCreating = false;
                    // Result display is handled by setting currentStep = 7 above
                },

                // Result actions
                async viewSite() {
                    // Check if site was already deployed
                    if (this.creationResult.deployed && this.creationResult.siteUrl) {
                        // Site is deployed, open it directly
                        window.open(this.creationResult.siteUrl, '_blank');
                    } else if (this.wizardData.deployOption === 'deploy') {
                        // Site should be deployed but wasn't (maybe failed), try to deploy now
                        try {
                            const response = await fetch(`/api/sites/wizard-user/${this.creationResult.siteId}/deploy`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({})
                            });
                            
                            if (response.ok) {
                                const result = await response.json();
                                if (result.site && result.site.url) {
                                    window.open(result.site.url, '_blank');
                                } else {
                                    alert(`🚀 Déploiement en cours...\n\nVotre site sera bientôt disponible.`);
                                }
                            } else {
                                alert(`⚠️ Le déploiement automatique a échoué.\n\nVous pouvez déployer votre site depuis le tableau de bord.`);
                            }
                        } catch (error) {
                            console.error('Deploy error:', error);
                            alert(`⚠️ Erreur de déploiement.\n\nVotre site "${this.creationResult.siteId}" a été créé mais doit être déployé manuellement.`);
                        }
                    } else {
                        // Site created but not deployed (user chose "create only")
                        alert(`✅ Votre site "${this.creationResult.siteId}" a été créé avec succès!\n\n📁 Configuration sauvegardée dans:\nconfigs/${this.creationResult.siteId}/\n\n🚀 Pour déployer votre site, utilisez le tableau de bord.`);
                    }
                },

                openDashboard() {
                    // Open the customer portal with the customer sites view
                    window.location.href = `/`;
                },

                // Notification system
                showNotification(message, type = 'info') {
                    // Create a simple toast notification
                    const toast = document.createElement('div');
                    toast.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                        type === 'success' ? 'bg-green-500 text-white' :
                        type === 'error' ? 'bg-red-500 text-white' :
                        'bg-blue-500 text-white'
                    }`;
                    toast.textContent = message;
                    
                    document.body.appendChild(toast);
                    
                    // Remove after 5 seconds
                    setTimeout(() => {
                        if (toast.parentElement) {
                            toast.parentElement.removeChild(toast);
                        }
                    }, 5000);
                },

                // Auto-save functionality
                autoSave() {
                    localStorage.setItem('wizardData', JSON.stringify(this.wizardData));
                },

                loadSavedData() {
                    const saved = localStorage.getItem('wizardData');
                    if (saved) {
                        try {
                            this.wizardData = { ...this.wizardData, ...JSON.parse(saved) };
                        } catch (error) {
                            console.error('Error loading saved data:', error);
                        }
                    }
                }
            };
        }
    </script>
</body>
</html>